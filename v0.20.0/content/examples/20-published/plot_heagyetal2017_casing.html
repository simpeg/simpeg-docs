

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Heagy et al., 2017 Casing Example &#8212; SimPEG 0.20.0.post2 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery.css?v=61a4c737" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css?v=45118af6" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=8cf59ab3"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/examples/20-published/plot_heagyetal2017_casing';</script>
    <link rel="icon" href="../../../_static/logo-block.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Heagy et al., 2017 1D FDEM and TDEM inversions" href="plot_heagyetal2017_cyl_inversions.html" />
    <link rel="prev" title="Effective Medium Theory Mapping" href="plot_effective_medium_theory.html" />

  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>

<meta name="description" content="Simulation and Parameter Estimation in Geophysics">
<meta name="author" content="SimPEG Developers">
<meta name="keywords" content="python, geophysics, inversion, electromagnetics, magnetotellurics, magnetics, gravity, DC, flow inverse problems, open source, finite volume">


<script defer data-domain="docs.simpeg.xyz" src="https://plausible.io/js/script.js"></script>

  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/simpeg-logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../../_static/simpeg-logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../getting_started/index.html">
                        Getting Started
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../../user_guide.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../api/index.html">
                        API Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../release/index.html">
                        Release Notes
                      </a>
                    </li>
                

                <li class="nav-item">
                  <a class="nav-link nav-external" href="https://simpeg.xyz">
                    SimPEG
                  </a>
                </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                <li class="nav-item">
                  <a class="nav-link nav-external" href="http://slack.simpeg.xyz">
                    Contact
                  </a>
                </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/simpeg/simpeg" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="http://slack.simpeg.xyz/" title="Slack" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-slack"></i></span>
            <label class="sr-only">Slack</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://simpeg.discourse.group/" title="Discourse" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-discourse"></i></span>
            <label class="sr-only">Discourse</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://www.youtube.com/c/geoscixyz" title="Youtube" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-youtube"></i></span>
            <label class="sr-only">Youtube</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/simpegpy" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-twitter"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../getting_started/index.html">
                        Getting Started
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../../user_guide.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../api/index.html">
                        API Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../release/index.html">
                        Release Notes
                      </a>
                    </li>
                

                <li class="nav-item">
                  <a class="nav-link nav-external" href="https://simpeg.xyz">
                    SimPEG
                  </a>
                </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                <li class="nav-item">
                  <a class="nav-link nav-external" href="http://slack.simpeg.xyz">
                    Contact
                  </a>
                </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/simpeg/simpeg" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="http://slack.simpeg.xyz/" title="Slack" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-slack"></i></span>
            <label class="sr-only">Slack</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://simpeg.discourse.group/" title="Discourse" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-discourse"></i></span>
            <label class="sr-only">Discourse</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://www.youtube.com/c/geoscixyz" title="Youtube" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-youtube"></i></span>
            <label class="sr-only">Youtube</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/simpegpy" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-twitter"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorials/01-models_mapping/index.html">Models and Mapping</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/01-models_mapping/plot_1_tensor_models.html">Tensor Meshes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/01-models_mapping/plot_2_cyl_models.html">Cylindrical Meshes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/01-models_mapping/plot_3_tree_models.html">Tree Meshes</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorials/02-linear_inversion/index.html">Linear Problems</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/02-linear_inversion/plot_inv_1_inversion_lsq.html">Linear Least-Squares Inversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/02-linear_inversion/plot_inv_2_inversion_irls.html">Sparse Inversion with Iteratively Re-Weighted Least-Squares</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorials/03-gravity/index.html">Gravity</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/03-gravity/plot_1a_gravity_anomaly.html">Forward Simulation of Gravity Anomaly Data on a Tensor Mesh</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/03-gravity/plot_1b_gravity_gradiometry.html">Forward Simulation of Gradiometry Data on a Tree Mesh</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/03-gravity/plot_inv_1a_gravity_anomaly.html">Least-Squares Inversion of Gravity Anomaly Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/03-gravity/plot_inv_1b_gravity_anomaly_irls.html">Sparse Norm Inversion of Gravity Anomaly Data</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorials/04-magnetics/index.html">Magnetics</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/04-magnetics/plot_2a_magnetics_induced.html">Forward Simulation of Total Magnetic Intensity Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/04-magnetics/plot_2b_magnetics_mvi.html">Forward Simulation of Gradiometry Data for Magnetic Vector Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/04-magnetics/plot_inv_2a_magnetics_induced.html">Sparse Norm Inversion for Total Magnetic Intensity Data on a Tensor Mesh</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorials/05-dcr/index.html">Direct Current Resistivity</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/05-dcr/plot_fwd_1_dcr_sounding.html">Simulate a 1D Sounding over a Layered Earth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/05-dcr/plot_fwd_2_dcr2d.html">DC Resistivity Forward Simulation in 2.5D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/05-dcr/plot_fwd_3_dcr3d.html">DC Resistivity Forward Simulation in 3D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/05-dcr/plot_gen_3_3d_to_2d.html">Convert 3D DC/IP Data to 2D Lines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/05-dcr/plot_inv_1_dcr_sounding.html">Least-Squares 1D Inversion of Sounding Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/05-dcr/plot_inv_1_dcr_sounding_irls.html">Sparse 1D Inversion of Sounding Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/05-dcr/plot_inv_1_dcr_sounding_parametric.html">Parametric 1D Inversion of Sounding Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/05-dcr/plot_inv_2_dcr2d.html">2.5D DC Resistivity Least-Squares Inversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/05-dcr/plot_inv_2_dcr2d_irls.html">2.5D DC Resistivity Inversion with Sparse Norms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/05-dcr/plot_inv_3_dcr3d.html">3D Least-Squares Inversion of DC Resistivity Data</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorials/06-ip/index.html">Induced Polarization</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/06-ip/plot_fwd_2_dcip2d.html">2.5D Forward Simulation of a DCIP Line</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/06-ip/plot_fwd_3_dcip3d.html">DC/IP Forward Simulation in 3D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/06-ip/plot_inv_2_dcip2d.html">2.5D DC Resistivity and IP Least-Squares Inversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/06-ip/plot_inv_3_dcip3d.html">3D Least-Squares Inversion of DC and IP Data</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorials/07-fdem/index.html">Frequency-Domain Electromagnetics</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/07-fdem/plot_fwd_1_em1dfm.html">1D Forward Simulation for a Single Sounding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/07-fdem/plot_fwd_1_em1dfm_dispersive.html">1D Forward Simulation for a Susceptible and Chargeable Earth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/07-fdem/plot_fwd_2_fem_cyl.html">3D Forward Simulation on a Cylindrical Mesh</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/07-fdem/plot_fwd_3_fem_3d.html">3D Forward Simulation on a Tree Mesh</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/07-fdem/plot_inv_1_em1dfm.html">1D Inversion of for a Single Sounding</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorials/08-tdem/index.html">Time-Domain Electromagnetics</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/08-tdem/plot_fwd_1_em1dtm.html">1D Forward Simulation for a Single Sounding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/08-tdem/plot_fwd_1_em1dtm_dispersive.html">1D Forward Simulation with Chargeable and/or Magnetic Viscosity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/08-tdem/plot_fwd_1_em1dtm_waveforms.html">1D Forward Simulation with User-Defined Waveforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/08-tdem/plot_fwd_2_tem_cyl.html">3D Forward Simulation for Transient Response on a Cylindrical Mesh</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/08-tdem/plot_fwd_3_tem_3d.html">3D Forward Simulation with User-Defined Waveforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/08-tdem/plot_inv_1_em1dtm.html">1D Inversion of Time-Domain Data for a Single Sounding</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/09-nsem/index.html">Natural Source Electromagnetics</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorials/10-vrm/index.html">Viscous Remanent Magnetization</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/10-vrm/plot_fwd_1_vrm_layer.html">Response from a Homogeneous Layer for Different Waveforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/10-vrm/plot_fwd_2_vrm_topsoil.html">Forward Simulation of VRM Response on a Tree Mesh</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/10-vrm/plot_fwd_3_vrm_tem.html">Forward Simulation Including Inductive Response</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/11-flow/index.html">Flow</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorials/12-seismic/index.html">Seismic</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/12-seismic/plot_fwd_1_tomography_2D.html">Forward Simulation for Straight Ray Tomography in 2D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/12-seismic/plot_inv_1_tomography_2D.html">Sparse Norm Inversion of 2D Seismic Tomography Data</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorials/13-joint_inversion/index.html">Joint Inversion</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/13-joint_inversion/plot_inv_3_cross_gradient_pf.html">Cross-gradient Joint Inversion of Gravity and Magnetic Anomaly Data</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorials/14-pgi/index.html">Petrophysically Guided Inversion</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/14-pgi/plot_inv_1_joint_pf_pgi_full_info_tutorial.html">Joint PGI of Gravity + Magnetic on an Octree mesh using full petrophysical information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/14-pgi/plot_inv_2_joint_pf_pgi_no_info_tutorial.html">Joint PGI of Gravity + Magnetic on an Octree mesh without petrophysical information</a></li>
</ul>
</li>
</ul>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../index.html">Gallery</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../01-maps/index.html">Mappings</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-14"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../01-maps/plot_block_in_layer.html">Maps: Parametric Block in a Layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../01-maps/plot_combo.html">Maps: ComboMaps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../01-maps/plot_layer.html">Maps: Parametrized Layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../01-maps/plot_mesh2mesh.html">Maps: Mesh2Mesh</a></li>
<li class="toctree-l3"><a class="reference internal" href="../01-maps/plot_sumMap.html">Maps: ComboMaps</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../02-gravity/index.html">Gravity</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-15"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../02-gravity/plot_inv_grav_tiled.html">PF: Gravity: Tiled Inversion Linear</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../03-magnetics/index.html">Magnetics</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-16"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../03-magnetics/plot_0_analytic.html">PF: Magnetics: Analytics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../03-magnetics/plot_inv_mag_MVI_Sparse_TreeMesh.html">Magnetic inversion on a TreeMesh</a></li>
<li class="toctree-l3"><a class="reference internal" href="../03-magnetics/plot_inv_mag_MVI_VectorAmplitude.html">Magnetic inversion on a TreeMesh</a></li>
<li class="toctree-l3"><a class="reference internal" href="../03-magnetics/plot_inv_mag_nonLinear_Amplitude.html">Magnetic Amplitude inversion on a TreeMesh</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../04-dcip/index.html">DC Resistivity and Induced Polarization</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-17"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../04-dcip/plot_dc_analytic.html">DC Analytic Dipole</a></li>
<li class="toctree-l3"><a class="reference internal" href="../04-dcip/plot_inv_dcip_dipoledipole_3Dinversion_twospheres.html">3D DC inversion of Dipole Dipole array</a></li>
<li class="toctree-l3"><a class="reference internal" href="../04-dcip/plot_inv_dcip_dipoledipole_parametric_inversion.html">Parametric DC inversion with Dipole Dipole array</a></li>
<li class="toctree-l3"><a class="reference internal" href="../04-dcip/plot_read_DC_data_with_IO_class.html">Reading and Plotting data with DC.IO class</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../05-fdem/index.html">Frequency Domain Electromagnetics</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-18"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../05-fdem/plot_0_fdem_analytic.html">Simulation with Analytic FDEM Solutions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../05-fdem/plot_inv_fdem_loop_loop_2Dinversion.html">2D inversion of Loop-Loop EM Data</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../06-tdem/index.html">Time Domain Electromagnetics</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-19"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../06-tdem/plot_0_tdem_analytic.html">Simulation with Analytic TDEM Solutions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../06-tdem/plot_fwd_tdem_3d_model.html">Time-domain CSEM for a resistive cube in a deep marine setting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../06-tdem/plot_fwd_tdem_inductive_src_permeable_target.html">EM: TDEM: Permeable Target, Inductive Source</a></li>
<li class="toctree-l3"><a class="reference internal" href="../06-tdem/plot_fwd_tdem_waveforms.html">TDEM: Waveforms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../06-tdem/plot_inv_tdem_1D.html">EM: TDEM: 1D: Inversion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../06-tdem/plot_inv_tdem_1D_raw_waveform.html">EM: TDEM: 1D: Inversion with VTEM waveform</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../07-nsem/index.html">Natural Source Electromagnetics</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-20"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../07-nsem/plot_fwd_nsem_MTTipper3D.html">MT: 3D: Forward</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../08-vrm/index.html">Viscous Remanent Magnetization</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-21"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../08-vrm/plot_fwd_vrm.html">Predict Response from a Conductive and Magnetically Viscous Earth</a></li>
<li class="toctree-l3"><a class="reference internal" href="../08-vrm/plot_inv_vrm_eq.html">Method of Equivalent Sources for Removing VRM Responses</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../09-flow/index.html">Richards Fluid Flow</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-22"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../09-flow/plot_fwd_flow_richards_1D.html">FLOW: Richards: 1D: Forward Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../09-flow/plot_inv_flow_richards_1D.html">FLOW: Richards: 1D: Inversion</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../10-pgi/index.html">PGI: Petrophysically and Geologically guided Inversion</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-23"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../10-pgi/plot_inv_0_PGI_Linear_1D.html">Petrophysically guided inversion (PGI): Linear example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../10-pgi/plot_inv_1_PGI_Linear_1D_joint_WithRelationships.html">Petrophysically guided inversion: Joint linear example with nonlinear relationships</a></li>
</ul>
</li>
<li class="toctree-l2 current active has-children"><a class="reference internal" href="index.html">In Publication</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-24"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="plot_booky_1D_time_freq_inv.html">Heagy et al., 2017 1D RESOLVE and SkyTEM Bookpurnong Inversions</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_booky_1Dstitched_resolve_inv.html">Heagy et al., 2017 1D RESOLVE Bookpurnong Inversion</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_effective_medium_theory.html">Effective Medium Theory Mapping</a></li>
<li class="toctree-l3 current active"><a class="current reference internal" href="#">Heagy et al., 2017 Casing Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_heagyetal2017_cyl_inversions.html">Heagy et al., 2017 1D FDEM and TDEM inversions</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_laguna_del_maule_inversion.html">PF: Gravity: Laguna del Maule Bouguer Gravity</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_load_booky.html">Heagy et al., 2017 Load and Plot Bookpurnong Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_richards_celia1990.html">FLOW: Richards: 1D: Celia1990</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_schenkel_morrison_casing.html">EM: Schenkel and Morrison Casing Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_tomo_joint_with_volume.html">Straight Ray with Volume Data Misfit Term</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_vadose_vangenuchten.html">FLOW: Vadose: van Genuchten</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">





<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../user_guide.html" class="nav-link">User Guide</a></li>
    
    
    <li class="breadcrumb-item"><i class="fa-solid fa-ellipsis"></i></li>
    
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">In Publication</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Heagy et al., 2017 Casing Example</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-content-examples-20-published-plot-heagyetal2017-casing-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="heagy-et-al-2017-casing-example">
<span id="sphx-glr-content-examples-20-published-plot-heagyetal2017-casing-py"></span><h1>Heagy et al., 2017 Casing Example<a class="headerlink" href="#heagy-et-al-2017-casing-example" title="Permalink to this heading">#</a></h1>
<p>Here, we use a primary-secondary approach to compute the sensitivity of an EM
survey with respect to a parametric model of a block in a layered space.</p>
<p>If you run this example with <code class="code docutils literal notranslate"><span class="pre">reRun=False</span></code>, stored results for the
sensitivity will be downloaded and plotted. Otherwise, if <cite>reRun=True</cite>, the
example will be re-run. Note that you will need modest computational resources
to re-compute the sensitivity (it is a 3D EM problem!).</p>
<p>There are 6 plots that are produced. Figure 1 shows the primary current density
(the current density due to the source, casing and layered background), Figure
2 shows the secondary source - the source current density due to the 3D
conductivity structure present only in the secondary problem. Figure 3 shows
the predicted data. Figures 4-6 show the sensitivity with respect to each of
the 9 model parameters (the conductivity of the background, layer and block,
the thickness of the layer and the x and y extents of the block).</p>
<p>This example is used in the paper</p>
<blockquote>
<div><p>Lindsey J. Heagy, Rowan Cockett, Seogi Kang, Gudni K. Rosenkjaer, Douglas
W. Oldenburg, A framework for simulation and inversion in electromagnetics,
Computers &amp; Geosciences, Volume 107, 2017, Pages 1-19, ISSN 0098-3004,
<a class="reference external" href="http://dx.doi.org/10.1016/j.cageo.2017.06.018">http://dx.doi.org/10.1016/j.cageo.2017.06.018</a>.</p>
</div></blockquote>
<p>This example is available on figshare:
<a class="reference external" href="https://doi.org/10.6084/m9.figshare.5036123">https://doi.org/10.6084/m9.figshare.5036123</a></p>
<p>This example was updated for SimPEG 0.14.0 on January 31st, 2020 by Joseph Capriotti</p>
<ul class="sphx-glr-horizontal">
<li><img src="../../../_images/sphx_glr_plot_heagyetal2017_casing_001.png" srcset="../../../_images/sphx_glr_plot_heagyetal2017_casing_001.png" alt="Primary Current Density" class = "sphx-glr-multi-img"/></li>
<li><img src="../../../_images/sphx_glr_plot_heagyetal2017_casing_002.png" srcset="../../../_images/sphx_glr_plot_heagyetal2017_casing_002.png" alt="(a) -950m Depth Slice" class = "sphx-glr-multi-img"/></li>
<li><img src="../../../_images/sphx_glr_plot_heagyetal2017_casing_003.png" srcset="../../../_images/sphx_glr_plot_heagyetal2017_casing_003.png" alt="(a) Total E$_x$, (b) Total E$_y$, (c) Secondary E$_x$, (d) Secondary E$_y$" class = "sphx-glr-multi-img"/></li>
<li><img src="../../../_images/sphx_glr_plot_heagyetal2017_casing_004.png" srcset="../../../_images/sphx_glr_plot_heagyetal2017_casing_004.png" alt="(a) Sensitivity of $E_x$ wrt log($\sigma_{back}$), (b) Sensitivity of $E_y$ wrt log($\sigma_{back}$), (c) Sensitivity of $E_x$ wrt log($\sigma_{layer}$), (d) Sensitivity of $E_y$ wrt log($\sigma_{layer}$), (e) Sensitivity of $E_x$ wrt log($\sigma_{block}$), (f) Sensitivity of $E_y$ wrt log($\sigma_{block}$)" class = "sphx-glr-multi-img"/></li>
<li><img src="../../../_images/sphx_glr_plot_heagyetal2017_casing_005.png" srcset="../../../_images/sphx_glr_plot_heagyetal2017_casing_005.png" alt="(g) Sensitivity of $E_x$ wrt layer $z_0$, (h) Sensitivity of $E_y$ wrt layer $z_0$, (i) Sensitivity of $E_x$ wrt layer $h$, (j) Sensitivity of $E_y$ wrt layer $h$" class = "sphx-glr-multi-img"/></li>
<li><img src="../../../_images/sphx_glr_plot_heagyetal2017_casing_006.png" srcset="../../../_images/sphx_glr_plot_heagyetal2017_casing_006.png" alt="(k) Sensitivity of $E_x$ wrt block $x_0$, (l) Sensitivity of $E_y$ wrt block $x_0$, (m) Sensitivity of $E_x$ wrt block $y_0$, (n) Sensitivity of $E_y$ wrt block $y_0$, (o) Sensitivity of $E_x$ wrt block $d_x$, (p) Sensitivity of $E_y$ wrt block $d_x$, (q) Sensitivity of $E_x$ wrt block $d_y$, (r) Sensitivity of $E_y$ wrt block $d_y$" class = "sphx-glr-multi-img"/></li>
</ul>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Skin Depth: [7071.067811865475]
Downloading https://storage.googleapis.com/simpeg/papers/Heagyetal2016/Heagyetal2016Casing.hdf5
   saved to: /home/vsts/Downloads/simpegtemp/Heagyetal2016Casing.hdf5
Download completed!
Getting Primary Problem
Cyl Mesh Extent xmax: 88864.16819654894,: zmin: -289135.34091688367, zmax: 288135.8409168833
Building primary mapping
... done building primary mapping
... done building primary problem
Setting up primary survey
... done building primary survey
building secondary mapping
Secondary Mesh ...
 xmin, xmax, zmin, zmax:  -16593.292236328125 16593.292236328125 -16593.292236328125 16593.292236328125 -19170.57876586914 18170.57876586914
 nC, vnC 137700 (45, 45, 68)
... done building secondary mapping
Setting up Secondary Problem
... done setting up secondary problem
Building primaryMap2meshs
... done building primaryMap2meshs
Setting up Secondary Survey
... done secondary survey
Setting up Secondary Survey
... done secondary survey
Removing /home/vsts/Downloads/simpegtemp
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">discretize</span>
<span class="kn">from</span> <span class="nn">SimPEG</span> <span class="kn">import</span> <span class="n">utils</span><span class="p">,</span> <span class="n">maps</span><span class="p">,</span> <span class="n">tests</span>
<span class="kn">from</span> <span class="nn">SimPEG.electromagnetics</span> <span class="kn">import</span> <span class="n">frequency_domain</span> <span class="k">as</span> <span class="n">FDEM</span><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mu_0</span></a>
<span class="kn">from</span> <span class="nn">SimPEG.utils.io_utils</span> <span class="kn">import</span> <span class="n">download</span>

<span class="c1"># try:</span>
<span class="c1">#     from pymatsolver import MumpsSolver as Solver</span>
<span class="c1">#     print(&#39;using MumpsSolver&#39;)</span>
<span class="c1"># except ImportError:</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">pymatsolver</span> <span class="kn">import</span> <span class="n">Pardiso</span> <span class="k">as</span> <span class="n">Solver</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">SimPEG</span> <span class="kn">import</span> <span class="n">SolverLU</span> <span class="k">as</span> <span class="n">Solver</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.sparse</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.colors.LogNorm.html#matplotlib.colors.LogNorm" title="matplotlib.colors.LogNorm" class="sphx-glr-backref-module-matplotlib-colors sphx-glr-backref-type-py-class"><span class="n">LogNorm</span></a>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <a href="https://matplotlib.org/stable/api/matplotlib_configuration_api.html#matplotlib.RcParams" title="matplotlib.RcParams" class="sphx-glr-backref-module-matplotlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">rcParams</span></a>
<span class="kn">import</span> <span class="nn">h5py</span>

<a href="https://numpy.org/doc/stable/reference/random/generated/numpy.random.seed.html#numpy.random.seed" title="numpy.random.seed" class="sphx-glr-backref-module-numpy-random sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span></a><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fontsize</span></a> <span class="o">=</span> <span class="mi">12</span>
<a href="https://matplotlib.org/stable/api/matplotlib_configuration_api.html#matplotlib.RcParams" title="matplotlib.RcParams" class="sphx-glr-backref-module-matplotlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">rcParams</span></a><span class="p">[</span><span class="s2">&quot;font.size&quot;</span><span class="p">]</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fontsize</span></a>


<span class="k">class</span> <span class="nc">PrimSecCasingExample</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">NAME</span> <span class="o">=</span> <span class="s2">&quot;PrimSec_5e6Casing_50Mu_05Hz_LargeCondBody&quot;</span>

    <span class="c1"># -------------- SETUP MODEL PARAMS ---------------------------- #</span>

    <span class="n">sigmaair</span> <span class="o">=</span> <span class="mf">1e-8</span>  <span class="c1"># air</span>
    <span class="n">sigmaback</span> <span class="o">=</span> <span class="mf">1e-2</span>  <span class="c1"># background</span>

    <span class="n">sigmacasing</span> <span class="o">=</span> <span class="mf">5.5e6</span>  <span class="c1"># casing</span>
    <span class="n">sigmainside</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># inside the casing</span>
    <span class="n">mucasing</span> <span class="o">=</span> <span class="mi">50</span>  <span class="c1"># casing permeability</span>

    <span class="n">casing_l</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># length of the casing</span>
    <span class="n">casing_d</span> <span class="o">=</span> <span class="mf">10e-2</span>  <span class="c1"># 10cm diameter casing</span>
    <span class="n">casing_t</span> <span class="o">=</span> <span class="mf">1e-2</span>  <span class="c1"># 1cm thickness</span>

    <span class="c1"># layer</span>
    <span class="n">sigmalayer</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mf">10.0</span>
    <span class="n">layer_z</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.r_.html#numpy.r_" title="numpy.r_" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">r_</span></a><span class="p">[</span><span class="o">-</span><span class="mf">1000.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">900.0</span><span class="p">]</span>

    <span class="c1"># 3D body</span>
    <span class="n">sigmablock</span> <span class="o">=</span> <span class="mf">2.0</span>
    <span class="n">block_x</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.r_.html#numpy.r_" title="numpy.r_" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">r_</span></a><span class="p">[</span><span class="mf">75.0</span><span class="p">,</span> <span class="mf">475.0</span><span class="p">]</span>
    <span class="n">block_y</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.r_.html#numpy.r_" title="numpy.r_" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">r_</span></a><span class="p">[</span><span class="o">-</span><span class="mi">125</span><span class="p">,</span> <span class="mf">125.0</span><span class="p">]</span>
    <span class="n">block_z</span> <span class="o">=</span> <span class="n">layer_z</span>

    <span class="c1"># Survey Params</span>
    <span class="n">freqs</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.r_.html#numpy.r_" title="numpy.r_" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">r_</span></a><span class="p">[</span><span class="mf">0.5</span><span class="p">]</span>  <span class="c1"># frequencies 0.5</span>
    <span class="n">dsz</span> <span class="o">=</span> <span class="o">-</span><span class="mf">950.0</span>  <span class="c1"># down-hole z source location</span>

    <span class="n">src_a</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.r_.html#numpy.r_" title="numpy.r_" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">r_</span></a><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">dsz</span><span class="p">]</span>
    <span class="n">src_b</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.r_.html#numpy.r_" title="numpy.r_" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">r_</span></a><span class="p">[</span><span class="mf">1e4</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>  <span class="c1"># return electrode is a ring, 200</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># translate casing parameters to radial distances to outer casing wall,</span>
        <span class="c1"># inner casing wall, and casing length to z locations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">casing_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">casing_d</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">casing_a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">casing_r</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">casing_t</span> <span class="o">/</span> <span class="mf">2.0</span>  <span class="c1"># inner radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">casing_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">casing_r</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">casing_t</span> <span class="o">/</span> <span class="mf">2.0</span>  <span class="c1"># outer radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">casing_z</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.r_.html#numpy.r_" title="numpy.r_" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">r_</span></a><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">casing_l</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>

        <span class="c1"># Display skin depth so we can ensure our mesh goes further.</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Skin Depth: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="p">[(</span><span class="mf">500.0</span> <span class="o">/</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sigmaback</span> <span class="o">*</span> <span class="n">_</span><span class="p">))</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># -------------- Model --------------------------------- #</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mtrue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># This is the model we are using to compute the sensitivity. Each of</span>
        <span class="c1"># these parameters would be considered unknown in an inversion. This</span>
        <span class="c1"># model is of a parametrized block in a layer</span>
        <span class="c1">#</span>
        <span class="c1">#   +--------------------------------------+</span>
        <span class="c1">#   |                                      |</span>
        <span class="c1">#   |                                      |</span>
        <span class="c1">#   |            background                |</span>
        <span class="c1">#   |                                      |</span>
        <span class="c1">#   |                                      |</span>
        <span class="c1">#   +--------------------+-------+---------+</span>
        <span class="c1">#   |                    |       |         |</span>
        <span class="c1">#   |      layer         | block |         |</span>
        <span class="c1">#   |                    |       |         |</span>
        <span class="c1">#   +--------------------+-------+---------+</span>
        <span class="c1">#   |                                      |</span>
        <span class="c1">#   |                                      |</span>
        <span class="c1">#   |            background                |</span>
        <span class="c1">#   |                                      |</span>
        <span class="c1">#   |                                      |</span>
        <span class="c1">#   +--------------------------------------+</span>

        <span class="k">return</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.hstack.html#numpy.hstack" title="numpy.hstack" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">hstack</span></a><span class="p">(</span>
            <a href="https://numpy.org/doc/stable/reference/generated/numpy.r_.html#numpy.r_" title="numpy.r_" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">r_</span></a><span class="p">[</span>
                <a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">log</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sigmaback</span><span class="p">),</span>  <span class="c1"># value in background</span>
                <a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">log</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sigmalayer</span><span class="p">),</span>  <span class="c1"># value in the layer</span>
                <a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">log</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sigmablock</span><span class="p">),</span>  <span class="c1"># value in the block</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layer_z</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>  <span class="c1"># layer center</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layer_z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_z</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="c1"># layer thickness</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">block_x</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>  <span class="c1"># block x_0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">block_y</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>  <span class="c1"># block y_0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">block_x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="c1"># block dx</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">block_y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="c1"># block dy</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------- #</span>
    <span class="c1"># -------------- PRIMARY PROBLEM SETUP ---------------------------- #</span>
    <span class="c1"># ----------------------------------------------------------------- #</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">meshp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_meshp&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># -------------- Mesh Parameters ------------------ #</span>
            <span class="c1"># x-direction</span>
            <span class="n">csx1</span><span class="p">,</span> <span class="n">csx2</span> <span class="o">=</span> <span class="mf">2.5e-3</span><span class="p">,</span> <span class="mf">25.0</span>  <span class="c1"># fine cells near well bore</span>
            <span class="n">pfx1</span><span class="p">,</span> <span class="n">pfx2</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">,</span> <span class="mf">1.4</span>  <span class="c1"># padding factors: fine -&gt; uniform</span>
            <span class="n">ncx1</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">ceil</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">casing_b</span> <span class="o">/</span> <span class="n">csx1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># number of fine cells</span>
            <span class="c1"># (past casing wall)</span>
            <span class="n">dx2</span> <span class="o">=</span> <span class="mf">1000.0</span>  <span class="c1"># uniform mesh out to here</span>
            <span class="n">npadx2</span> <span class="o">=</span> <span class="mi">21</span>  <span class="c1"># padding out to infinity</span>

            <span class="c1"># z-direction</span>
            <span class="n">csz</span> <span class="o">=</span> <span class="mf">0.05</span>  <span class="c1"># finest z-cells</span>
            <span class="n">nza</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># number of fine cells above air-earth interface</span>
            <span class="n">pfz</span> <span class="o">=</span> <span class="n">pfx2</span>  <span class="c1"># padding factor in z-direction</span>

            <span class="c1"># ------------- Assemble the Cyl Mesh ------------- #</span>
            <span class="c1"># pad nicely to second cell size</span>
            <span class="n">npadx1</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">floor</span></a><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">log</span></a><span class="p">(</span><span class="n">csx2</span> <span class="o">/</span> <span class="n">csx1</span><span class="p">)</span> <span class="o">/</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">log</span></a><span class="p">(</span><span class="n">pfx1</span><span class="p">))</span>
            <span class="n">hx1a</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">unpack_widths</span><span class="p">([(</span><span class="n">csx1</span><span class="p">,</span> <span class="n">ncx1</span><span class="p">)])</span>
            <span class="n">hx1b</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">unpack_widths</span><span class="p">([(</span><span class="n">csx1</span><span class="p">,</span> <span class="n">npadx1</span><span class="p">,</span> <span class="n">pfx1</span><span class="p">)])</span>
            <span class="n">dx1</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">hx1a</span><span class="p">)</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">hx1b</span><span class="p">)</span>
            <span class="n">dx1</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">floor</span></a><span class="p">(</span><span class="n">dx1</span> <span class="o">/</span> <span class="n">csx2</span><span class="p">)</span>
            <span class="n">hx1b</span> <span class="o">*=</span> <span class="p">(</span><span class="n">dx1</span> <span class="o">*</span> <span class="n">csx2</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">hx1a</span><span class="p">))</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">hx1b</span><span class="p">)</span>

            <span class="c1"># second chunk of mesh</span>
            <span class="n">ncx2</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">ceil</span></a><span class="p">((</span><span class="n">dx2</span> <span class="o">-</span> <span class="n">dx1</span><span class="p">)</span> <span class="o">/</span> <span class="n">csx2</span><span class="p">)</span>
            <span class="n">hx2a</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">unpack_widths</span><span class="p">([(</span><span class="n">csx2</span><span class="p">,</span> <span class="n">ncx2</span><span class="p">)])</span>
            <span class="n">hx2b</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">unpack_widths</span><span class="p">([(</span><span class="n">csx2</span><span class="p">,</span> <span class="n">npadx2</span><span class="p">,</span> <span class="n">pfx2</span><span class="p">)])</span>
            <span class="n">hx</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.hstack.html#numpy.hstack" title="numpy.hstack" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">hstack</span></a><span class="p">([</span><span class="n">hx1a</span><span class="p">,</span> <span class="n">hx1b</span><span class="p">,</span> <span class="n">hx2a</span><span class="p">,</span> <span class="n">hx2b</span><span class="p">])</span>

            <span class="c1"># cell size, number of core cells, number of padding cells in the</span>
            <span class="c1"># x-direction</span>
            <span class="n">ncz</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">ceil</span></a><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.diff.html#numpy.diff" title="numpy.diff" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">diff</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">casing_z</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">csz</span><span class="p">))</span> <span class="o">+</span> <span class="mi">10</span>
            <span class="n">npadzu</span><span class="p">,</span> <span class="n">npadzd</span> <span class="o">=</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">43</span>

            <span class="c1"># vector of cell widths in the z-direction</span>
            <span class="n">hz</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">unpack_widths</span><span class="p">(</span>
                <span class="p">[(</span><span class="n">csz</span><span class="p">,</span> <span class="n">npadzd</span><span class="p">,</span> <span class="o">-</span><span class="n">pfz</span><span class="p">),</span> <span class="p">(</span><span class="n">csz</span><span class="p">,</span> <span class="n">ncz</span><span class="p">),</span> <span class="p">(</span><span class="n">csz</span><span class="p">,</span> <span class="n">npadzu</span><span class="p">,</span> <span class="n">pfz</span><span class="p">)]</span>
            <span class="p">)</span>

            <span class="c1"># primary mesh</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meshp</span> <span class="o">=</span> <a href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.CylindricalMesh.html#discretize.CylindricalMesh" title="discretize.CylindricalMesh" class="sphx-glr-backref-module-discretize sphx-glr-backref-type-py-class"><span class="n">discretize</span><span class="o">.</span><span class="n">CylindricalMesh</span></a><span class="p">(</span>
                <span class="p">[</span><span class="n">hx</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">hz</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.sum.html#numpy.sum" title="numpy.sum" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">sum</span></a><span class="p">(</span><span class="n">hz</span><span class="p">[:</span> <span class="n">npadzu</span> <span class="o">+</span> <span class="n">ncz</span> <span class="o">-</span> <span class="n">nza</span><span class="p">])]</span>
            <span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Cyl Mesh Extent xmax: </span><span class="si">{}</span><span class="s2">,: zmin: </span><span class="si">{}</span><span class="s2">, zmax: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_meshp</span><span class="o">.</span><span class="n">cell_centers_x</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_meshp</span><span class="o">.</span><span class="n">cell_centers_z</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_meshp</span><span class="o">.</span><span class="n">cell_centers_z</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meshp</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">indActivePrimary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshp</span><span class="o">.</span><span class="n">gridCC</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span>  <span class="c1"># air cells</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">projectionMapPrimary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">maps</span><span class="o">.</span><span class="n">Projection</span><span class="p">(</span><span class="n">nP</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.r_.html#numpy.r_" title="numpy.r_" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">r_</span></a><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">primaryMapping</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Setup Pimary Maps:</span>
        <span class="c1"># we want to simulate on a physical property model that</span>
        <span class="c1"># consists of casing in a layered background. Air cells are included.</span>
        <span class="c1"># Our &quot;model&quot;, that we are considering when computing the sensitivity,</span>
        <span class="c1"># consists of the layered background and block, so the casing and air</span>
        <span class="c1"># cells are inactive parts of the model and need to be appropriately</span>
        <span class="c1"># injected during the construction of the primary model</span>

        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_primaryMapping&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Building primary mapping&quot;</span><span class="p">)</span>

            <span class="c1"># inject parameters we want to invert for into the full casing</span>
            <span class="c1"># model</span>
            <span class="n">valInactive</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.r_.html#numpy.r_" title="numpy.r_" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">r_</span></a><span class="p">[</span>
                <a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">log</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sigmacasing</span><span class="p">),</span>  <span class="c1"># log conductivity of the casing</span>
                <a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">log</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sigmainside</span><span class="p">),</span>  <span class="c1"># log conductivity fluid inside</span>
                <span class="c1"># casing</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">casing_r</span><span class="p">,</span>  <span class="c1"># radius of the casing (to its center)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">casing_t</span><span class="p">,</span>  <span class="c1"># casing thickness</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">casing_z</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="c1"># bottom of casing (at depth)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">casing_z</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>  <span class="c1"># top of casing (at surface)</span>
            <span class="p">]</span>

            <span class="c1"># inject casing parameters so they are included in the construction</span>
            <span class="c1"># of the layered background + casing</span>
            <span class="n">injectCasingParams</span> <span class="o">=</span> <span class="n">maps</span><span class="o">.</span><span class="n">InjectActiveCells</span><span class="p">(</span>
                <span class="kc">None</span><span class="p">,</span> <span class="n">indActive</span><span class="o">=</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.r_.html#numpy.r_" title="numpy.r_" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">r_</span></a><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">valInactive</span><span class="o">=</span><span class="n">valInactive</span><span class="p">,</span> <span class="n">nC</span><span class="o">=</span><span class="mi">10</span>
            <span class="p">)</span>

            <span class="c1"># maps a list of casing parameters to the cyl mesh (below the</span>
            <span class="c1"># subsurface)</span>
            <span class="n">paramMapPrimary</span> <span class="o">=</span> <span class="n">maps</span><span class="o">.</span><span class="n">ParametricCasingAndLayer</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meshp</span><span class="p">,</span> <span class="n">indActive</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">indActivePrimary</span><span class="p">,</span> <span class="n">slopeFact</span><span class="o">=</span><span class="mf">1e4</span>
            <span class="p">)</span>

            <span class="c1"># inject air cells</span>
            <span class="n">injActMapPrimary</span> <span class="o">=</span> <span class="n">maps</span><span class="o">.</span><span class="n">InjectActiveCells</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meshp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indActivePrimary</span><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">log</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sigmaair</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># map from log conductivity to conductivity</span>
            <span class="n">expMapPrimary</span> <span class="o">=</span> <span class="n">maps</span><span class="o">.</span><span class="n">ExpMap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshp</span><span class="p">)</span>

            <span class="c1"># assemble the primary mapping</span>
            <span class="n">primaryMapping</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">expMapPrimary</span>
                <span class="o">*</span> <span class="n">injActMapPrimary</span>  <span class="c1"># log(sigma) --&gt; sigma</span>
                <span class="o">*</span> <span class="n">paramMapPrimary</span>  <span class="c1"># log(sigma) below surface --&gt; include air</span>
                <span class="o">*</span> <span class="n">injectCasingParams</span>  <span class="c1"># parametric --&gt; casing + layered earth</span>
                <span class="o">*</span>  <span class="c1"># parametric layered earth --&gt; parametric</span>
                <span class="c1"># layered earth + casing</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">projectionMapPrimary</span>  <span class="c1"># grab relevant parameters from full</span>
                <span class="c1"># model (eg. ignore block)</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_paramMapPrimary</span> <span class="o">=</span> <span class="n">paramMapPrimary</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_primaryMapping</span> <span class="o">=</span> <span class="n">primaryMapping</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;... done building primary mapping&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_primaryMapping</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">muModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Mu Model</span>
        <span class="c1"># here, we want to consider variable magnetic permeability in the</span>
        <span class="c1"># simulation. The only permeable item in the domain is the casing.</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_muModel&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_paramMapPrimary&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">primaryMapping</span>

            <span class="n">muMap</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">maps</span><span class="o">.</span><span class="n">InjectActiveCells</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indActivePrimary</span><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mu_0</span></a><span class="p">)</span>
                <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paramMapPrimary</span>
            <span class="p">)</span>

            <span class="n">muModel</span> <span class="o">=</span> <span class="n">muMap</span> <span class="o">*</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.hstack.html#numpy.hstack" title="numpy.hstack" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">hstack</span></a><span class="p">(</span>
                <a href="https://numpy.org/doc/stable/reference/generated/numpy.r_.html#numpy.r_" title="numpy.r_" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">r_</span></a><span class="p">[</span>
                    <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mu_0</span></a><span class="p">,</span>  <span class="c1"># val Background</span>
                    <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mu_0</span></a><span class="p">,</span>  <span class="c1"># val Layer</span>
                    <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mu_0</span></a> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">mucasing</span><span class="p">,</span>  <span class="c1"># val Casing</span>
                    <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mu_0</span></a><span class="p">,</span>  <span class="c1"># val inside Casing</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">layer_z</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>  <span class="c1"># layer center</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">layer_z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_z</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="c1"># layer thickness</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">casing_r</span><span class="p">,</span>  <span class="c1"># casing radius</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">casing_t</span><span class="p">,</span>  <span class="c1"># casing thickness</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">casing_z</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="c1"># casing bottom</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">casing_z</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>  <span class="c1"># casing top</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_muModel</span> <span class="o">=</span> <span class="n">muModel</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_muModel</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">primaryProblem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_primaryProblem&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># define a custom prop map to include variable mu that we are not</span>
            <span class="c1"># inverting for - This will change when we improve the propmap!</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Getting Primary Problem&quot;</span><span class="p">)</span>

            <span class="c1"># class CasingEMPropMap(maps.PropMap):</span>

            <span class="c1">#     sigma = maps.Property(</span>
            <span class="c1">#                 &quot;Electrical Conductivity&quot;, defaultInvProp=True,</span>
            <span class="c1">#                 propertyLink=(&#39;rho&#39;, maps.ReciprocalMap)</span>
            <span class="c1">#     )</span>
            <span class="c1">#     mu = maps.Property(</span>
            <span class="c1">#             &quot;Inverse Magnetic Permeability&quot;,</span>
            <span class="c1">#             defaultVal=self.muModel,</span>
            <span class="c1">#             propertyLink=(&#39;mui&#39;, maps.ReciprocalMap)</span>
            <span class="c1">#     )</span>
            <span class="c1">#     rho = maps.Property(</span>
            <span class="c1">#             &quot;Electrical Resistivity&quot;,</span>
            <span class="c1">#             propertyLink=(&#39;sigma&#39;, maps.ReciprocalMap)</span>
            <span class="c1">#     )</span>
            <span class="c1">#     mui = maps.Property(</span>
            <span class="c1">#             &quot;Inverse Magnetic Permeability&quot;,</span>
            <span class="c1">#             defaultVal=1./self.muModel,</span>
            <span class="c1">#             propertyLink=(&#39;mu&#39;, maps.ReciprocalMap)</span>
            <span class="c1">#     )</span>

            <span class="c1"># # set the problem&#39;s propmap</span>
            <span class="c1"># FDEM.Simulation3DMagneticField.PropMap = CasingEMPropMap</span>

            <span class="c1"># use H-J formulation for source with vertical current density and</span>
            <span class="c1"># cylindrical symmetry (h faster on cyl --&gt; less edges than faces)</span>
            <span class="n">primaryProblem</span> <span class="o">=</span> <span class="n">FDEM</span><span class="o">.</span><span class="n">Simulation3DMagneticField</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meshp</span><span class="p">,</span> <span class="n">sigmaMap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">primaryMapping</span>
            <span class="p">)</span>
            <span class="n">primaryProblem</span><span class="o">.</span><span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">muModel</span>

            <span class="n">primaryProblem</span><span class="o">.</span><span class="n">solver</span> <span class="o">=</span> <span class="n">Solver</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_primaryProblem</span> <span class="o">=</span> <span class="n">primaryProblem</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;... done building primary problem&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_primaryProblem</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">primarySurvey</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_primarySurvey&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Setting up primary survey&quot;</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">setupPrimarySource</span><span class="p">(</span><span class="n">plotIt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                <span class="c1"># Construct a downhole source that is coupled to the casing</span>
                <span class="n">meshp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshp</span>
                <span class="n">src_a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">src_a</span>
                <span class="n">src_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">src_b</span>
                <span class="n">casing_a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">casing_a</span>

                <span class="c1"># downhole source</span>
                <span class="n">dg_x</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.zeros.html#numpy.zeros" title="numpy.zeros" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">zeros</span></a><span class="p">(</span><span class="n">meshp</span><span class="o">.</span><span class="n">vnF</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
                <span class="n">dg_y</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.zeros.html#numpy.zeros" title="numpy.zeros" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">zeros</span></a><span class="p">(</span><span class="n">meshp</span><span class="o">.</span><span class="n">vnF</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
                <span class="n">dg_z</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.zeros.html#numpy.zeros" title="numpy.zeros" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">zeros</span></a><span class="p">(</span><span class="n">meshp</span><span class="o">.</span><span class="n">vnF</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>

                <span class="c1"># vertically directed wire in borehole</span>
                <span class="c1"># go through the center of the well</span>
                <span class="n">dgv_indx</span> <span class="o">=</span> <span class="n">meshp</span><span class="o">.</span><span class="n">gridFz</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">meshp</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                <span class="n">dgv_indz</span> <span class="o">=</span> <span class="p">(</span><span class="n">meshp</span><span class="o">.</span><span class="n">gridFz</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">src_a</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
                    <span class="n">meshp</span><span class="o">.</span><span class="n">gridFz</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">src_b</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">dgv_ind</span> <span class="o">=</span> <span class="n">dgv_indx</span> <span class="o">&amp;</span> <span class="n">dgv_indz</span>
                <span class="n">dg_z</span><span class="p">[</span><span class="n">dgv_ind</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>

                <span class="c1"># couple to the casing downhole - top part</span>
                <span class="n">dgh_indx</span> <span class="o">=</span> <span class="n">meshp</span><span class="o">.</span><span class="n">gridFx</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">casing_a</span> <span class="o">+</span> <span class="n">meshp</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span>

                <span class="c1"># couple to the casing downhole - bottom part</span>
                <span class="n">dgh_indz2</span> <span class="o">=</span> <span class="p">(</span><span class="n">meshp</span><span class="o">.</span><span class="n">gridFx</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">src_a</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
                    <span class="n">meshp</span><span class="o">.</span><span class="n">gridFx</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">src_a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">meshp</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="n">dgh_ind2</span> <span class="o">=</span> <span class="n">dgh_indx</span> <span class="o">&amp;</span> <span class="n">dgh_indz2</span>
                <span class="n">dg_x</span><span class="p">[</span><span class="n">dgh_ind2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

                <span class="c1"># horizontally directed wire</span>
                <span class="n">sgh_indx</span> <span class="o">=</span> <span class="n">meshp</span><span class="o">.</span><span class="n">gridFx</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">src_b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">sgh_indz</span> <span class="o">=</span> <span class="p">(</span><span class="n">meshp</span><span class="o">.</span><span class="n">gridFx</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">meshp</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span>
                    <span class="n">meshp</span><span class="o">.</span><span class="n">gridFx</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">meshp</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="n">sgh_ind</span> <span class="o">=</span> <span class="n">sgh_indx</span> <span class="o">&amp;</span> <span class="n">sgh_indz</span>
                <span class="n">dg_x</span><span class="p">[</span><span class="n">sgh_ind</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>

                <span class="c1"># return electrode</span>
                <span class="n">sgv_indx</span> <span class="o">=</span> <span class="p">(</span><span class="n">meshp</span><span class="o">.</span><span class="n">gridFz</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">src_b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
                    <span class="n">meshp</span><span class="o">.</span><span class="n">gridFz</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">src_b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.1</span>
                <span class="p">)</span>
                <span class="n">sgv_indz</span> <span class="o">=</span> <span class="p">(</span><span class="n">meshp</span><span class="o">.</span><span class="n">gridFz</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="n">meshp</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span>
                    <span class="n">meshp</span><span class="o">.</span><span class="n">gridFz</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">meshp</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="n">sgv_ind</span> <span class="o">=</span> <span class="n">sgv_indx</span> <span class="o">&amp;</span> <span class="n">sgv_indz</span>
                <span class="n">dg_z</span><span class="p">[</span><span class="n">sgv_ind</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

                <span class="c1"># assemble the source (downhole grounded primary)</span>
                <span class="n">dg</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.hstack.html#numpy.hstack" title="numpy.hstack" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">hstack</span></a><span class="p">([</span><span class="n">dg_x</span><span class="p">,</span> <span class="n">dg_y</span><span class="p">,</span> <span class="n">dg_z</span><span class="p">])</span>
                <span class="n">dg_p</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">FDEM</span><span class="o">.</span><span class="n">Src</span><span class="o">.</span><span class="n">RawVec_e</span><span class="p">([],</span> <span class="n">_</span><span class="p">,</span> <span class="n">dg</span> <span class="o">/</span> <span class="n">meshp</span><span class="o">.</span><span class="n">face_areas</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span>
                <span class="p">]</span>

                <span class="c1"># if plotIt:</span>
                <span class="c1">#     # Plot the source to make sure the path is infact</span>
                <span class="c1">#     # connected</span>

                <span class="c1">#     fig, ax = plt.subplots(1, 1, figsize=(6, 4))</span>
                <span class="c1">#     meshp.plot_grid(ax=ax)</span>
                <span class="c1">#     ax.plot(meshp.gridFz[dgv_ind, 0], meshp.gridFz[dgv_ind, 2], &#39;rd&#39;)</span>
                <span class="c1">#     ax.plot(meshp.gridFx[dgh_ind2, 0], meshp.gridFx[dgh_ind2, 2], &#39;rd&#39;)</span>
                <span class="c1">#     ax.plot(meshp.gridFz[sgv_ind, 0], meshp.gridFz[sgv_ind, 2], &#39;rd&#39;)</span>
                <span class="c1">#     ax.plot(meshp.gridFx[sgh_ind, 0], meshp.gridFx[sgh_ind, 2], &#39;rd&#39;)</span>

                <span class="c1">#     ax.set_title(&#39;downhole casing source on mesh&#39;)</span>

                <span class="c1">#     ax.set_xlim([0, 1.1e4])</span>
                <span class="c1">#     ax.set_ylim([-1100., 0.5])</span>

                <span class="k">return</span> <span class="n">dg_p</span>

            <span class="n">source_list</span> <span class="o">=</span> <span class="n">setupPrimarySource</span><span class="p">()</span>  <span class="c1"># create primary source</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_primarySurvey</span> <span class="o">=</span> <span class="n">FDEM</span><span class="o">.</span><span class="n">Survey</span><span class="p">(</span><span class="n">source_list</span><span class="p">)</span>  <span class="c1"># primary survey</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;... done building primary survey&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_primarySurvey</span>

    <span class="k">def</span> <span class="nf">solvePrimary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">primaryProblem</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">saveFields</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtrue</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;solving primary ...&quot;</span><span class="p">)</span>
        <span class="n">t0</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/time.html#time.time" title="time.time" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><span class="n">time</span><span class="o">.</span><span class="n">time</span></a><span class="p">()</span>
        <span class="n">primfields</span> <span class="o">=</span> <span class="n">primaryProblem</span><span class="o">.</span><span class="n">fields</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">t1</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/time.html#time.time" title="time.time" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><span class="n">time</span><span class="o">.</span><span class="n">time</span></a><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done solving primary fields, time </span><span class="si">{}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">primfields</span>

    <span class="k">def</span> <span class="nf">plotPrimaryMesh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meshp</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.title.html#matplotlib.pyplot.title" title="matplotlib.pyplot.title" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">title</span></a><span class="p">(</span><span class="s2">&quot;Cyl Mesh&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">plotPrimaryProperties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshp</span><span class="o">.</span><span class="n">plot_image</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">muModel</span> <span class="o">/</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mu_0</span></a><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">pcolor_opts</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;cmap&quot;</span><span class="p">:</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.get_cmap.html#matplotlib.pyplot.get_cmap" title="matplotlib.pyplot.get_cmap" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span></a><span class="p">(</span><span class="s2">&quot;viridis&quot;</span><span class="p">)},</span>
            <span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.colorbar.html#matplotlib.pyplot.colorbar" title="matplotlib.pyplot.colorbar" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span></a><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">1.5e3</span><span class="p">,</span> <span class="mi">500</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;mu_r&quot;</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshp</span><span class="o">.</span><span class="n">plot_image</span><span class="p">(</span>
            <a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">log10</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primaryMapping</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtrue</span><span class="p">),</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">pcolor_opts</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;cmap&quot;</span><span class="p">:</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.get_cmap.html#matplotlib.pyplot.get_cmap" title="matplotlib.pyplot.get_cmap" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span></a><span class="p">(</span><span class="s2">&quot;viridis&quot;</span><span class="p">)},</span>
            <span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.colorbar.html#matplotlib.pyplot.colorbar" title="matplotlib.pyplot.colorbar" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span></a><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">1.5e3</span><span class="p">,</span> <span class="mi">500</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;log10 sigma&quot;</span><span class="p">)</span>

        <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.tight_layout.html#matplotlib.pyplot.tight_layout" title="matplotlib.pyplot.tight_layout" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span></a><span class="p">()</span>
        <span class="k">return</span> <span class="n">ax</span>

    <span class="c1"># ----------------------------------------------------------------- #</span>
    <span class="c1"># -------------- SECONDARY PROBLEM SETUP -------------------------- #</span>
    <span class="c1"># ----------------------------------------------------------------- #</span>

    <span class="c1"># -------------- MESH  -------------------------------------------- #</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">meshs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_meshs&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">csx</span><span class="p">,</span> <span class="n">ncx</span><span class="p">,</span> <span class="n">npadx</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">12</span>
            <span class="n">csy</span><span class="p">,</span> <span class="n">ncy</span><span class="p">,</span> <span class="n">npady</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">12</span>
            <span class="n">csz</span><span class="p">,</span> <span class="n">ncz</span><span class="p">,</span> <span class="n">npadz</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">14</span>
            <span class="n">pf</span> <span class="o">=</span> <span class="mf">1.5</span>

            <span class="n">hx</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">unpack_widths</span><span class="p">([(</span><span class="n">csx</span><span class="p">,</span> <span class="n">npadx</span><span class="p">,</span> <span class="o">-</span><span class="n">pf</span><span class="p">),</span> <span class="p">(</span><span class="n">csx</span><span class="p">,</span> <span class="n">ncx</span><span class="p">),</span> <span class="p">(</span><span class="n">csx</span><span class="p">,</span> <span class="n">npadx</span><span class="p">,</span> <span class="n">pf</span><span class="p">)])</span>
            <span class="n">hy</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">unpack_widths</span><span class="p">([(</span><span class="n">csy</span><span class="p">,</span> <span class="n">npady</span><span class="p">,</span> <span class="o">-</span><span class="n">pf</span><span class="p">),</span> <span class="p">(</span><span class="n">csy</span><span class="p">,</span> <span class="n">ncy</span><span class="p">),</span> <span class="p">(</span><span class="n">csy</span><span class="p">,</span> <span class="n">npady</span><span class="p">,</span> <span class="n">pf</span><span class="p">)])</span>
            <span class="n">hz</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">unpack_widths</span><span class="p">([(</span><span class="n">csz</span><span class="p">,</span> <span class="n">npadz</span><span class="p">,</span> <span class="o">-</span><span class="n">pf</span><span class="p">),</span> <span class="p">(</span><span class="n">csz</span><span class="p">,</span> <span class="n">ncz</span><span class="p">),</span> <span class="p">(</span><span class="n">csz</span><span class="p">,</span> <span class="n">npadz</span><span class="p">,</span> <span class="n">pf</span><span class="p">)])</span>

            <span class="n">x0</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.r_.html#numpy.r_" title="numpy.r_" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">r_</span></a><span class="p">[</span><span class="o">-</span><span class="n">hx</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="n">hy</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="n">hz</span><span class="p">[:</span> <span class="n">npadz</span> <span class="o">+</span> <span class="n">ncz</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meshs</span> <span class="o">=</span> <a href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TensorMesh.html#discretize.TensorMesh" title="discretize.TensorMesh" class="sphx-glr-backref-module-discretize sphx-glr-backref-type-py-class"><span class="n">discretize</span><span class="o">.</span><span class="n">TensorMesh</span></a><span class="p">([</span><span class="n">hx</span><span class="p">,</span> <span class="n">hy</span><span class="p">,</span> <span class="n">hz</span><span class="p">],</span> <span class="n">x0</span><span class="o">=</span><span class="n">x0</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Secondary Mesh ... &quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot; xmin, xmax, zmin, zmax: &quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_meshs</span><span class="o">.</span><span class="n">cell_centers_x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_meshs</span><span class="o">.</span><span class="n">cell_centers_x</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_meshs</span><span class="o">.</span><span class="n">cell_centers_y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_meshs</span><span class="o">.</span><span class="n">cell_centers_y</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_meshs</span><span class="o">.</span><span class="n">cell_centers_z</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_meshs</span><span class="o">.</span><span class="n">cell_centers_z</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; nC, vnC&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meshs</span><span class="o">.</span><span class="n">nC</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meshs</span><span class="o">.</span><span class="n">vnC</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meshs</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">indActive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshs</span><span class="o">.</span><span class="n">gridCC</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span>  <span class="c1"># air cells</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">injActMap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">maps</span><span class="o">.</span><span class="n">InjectActiveCells</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indActive</span><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">log</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sigmaair</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">expMap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">maps</span><span class="o">.</span><span class="n">ExpMap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># secondary mapping</span>
        <span class="c1"># here, we construct the parametric mapping to take the parameters</span>
        <span class="c1"># describing the block in a layered space and map it to a conductivity</span>
        <span class="c1"># model on our mesh</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_mapping&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;building secondary mapping&quot;</span><span class="p">)</span>
            <span class="n">paramMap</span> <span class="o">=</span> <span class="n">maps</span><span class="o">.</span><span class="n">ParametricBlockInLayer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshs</span><span class="p">,</span> <span class="n">indActive</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">indActive</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expMap</span>
                <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">injActMap</span>  <span class="c1"># log sigma --&gt; sigma</span>
                <span class="o">*</span> <span class="n">paramMap</span>  <span class="c1"># inject air cells  # block in a layered space (subsurface)</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;... done building secondary mapping&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">primaryMap2meshs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_primaryMap2mesh&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># map the primary model to the secondary mesh (layer without the</span>
            <span class="c1"># block)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Building primaryMap2meshs&quot;</span><span class="p">)</span>
            <span class="n">paramMapPrimaryMeshs</span> <span class="o">=</span> <span class="n">maps</span><span class="o">.</span><span class="n">ParametricLayer</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meshs</span><span class="p">,</span> <span class="n">indActive</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">indActive</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_primaryMap2mesh</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expMap</span>
                <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">injActMap</span>  <span class="c1"># log sigma --&gt; sigma</span>
                <span class="o">*</span> <span class="n">paramMapPrimaryMeshs</span>  <span class="c1"># include air cells</span>
                <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">projectionMapPrimary</span>  <span class="c1"># parametrized layer  # grab correct indices</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;... done building primaryMap2meshs&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_primaryMap2mesh</span>

    <span class="c1"># -------------- PROBLEM and SURVEY ---------------------------- #</span>
    <span class="k">def</span> <span class="nf">setupSecondaryProblem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Setting up Secondary Problem&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mapping</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mapping</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">maps</span><span class="o">.</span><span class="n">IdentityMap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshs</span><span class="p">))]</span>
        <span class="n">sec_problem</span> <span class="o">=</span> <span class="n">FDEM</span><span class="o">.</span><span class="n">Simulation3DElectricField</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshs</span><span class="p">,</span> <span class="n">sigmaMap</span><span class="o">=</span><span class="n">mapping</span><span class="p">)</span>
        <span class="n">sec_problem</span><span class="o">.</span><span class="n">solver</span> <span class="o">=</span> <span class="n">Solver</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;... done setting up secondary problem&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sec_problem</span>

    <span class="k">def</span> <span class="nf">setupSecondarySurvey</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">primaryProblem</span><span class="p">,</span> <span class="n">primarySurvey</span><span class="p">,</span> <span class="n">map2meshSecondary</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Setting up Secondary Survey&quot;</span><span class="p">)</span>

        <span class="n">nx</span> <span class="o">=</span> <span class="mi">41</span>
        <span class="n">ny</span> <span class="o">=</span> <span class="n">nx</span>
        <span class="n">rx_x</span><span class="p">,</span> <span class="n">rx_y</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">[</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.linspace.html#numpy.linspace" title="numpy.linspace" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">linspace</span></a><span class="p">(</span><span class="o">-</span><span class="mi">2050</span><span class="p">,</span> <span class="mi">2050</span><span class="p">,</span> <span class="n">nx</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rxlocs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">ndgrid</span><span class="p">([</span><span class="n">rx_x</span><span class="p">,</span> <span class="n">rx_y</span><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.r_.html#numpy.r_" title="numpy.r_" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">r_</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rx_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rxlocs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rx_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rxlocs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>

        <span class="n">rx_ex</span> <span class="o">=</span> <span class="n">FDEM</span><span class="o">.</span><span class="n">Rx</span><span class="o">.</span><span class="n">PointElectricField</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rxlocs</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="s2">&quot;real&quot;</span>
        <span class="p">)</span>
        <span class="n">rx_ey</span> <span class="o">=</span> <span class="n">FDEM</span><span class="o">.</span><span class="n">Rx</span><span class="o">.</span><span class="n">PointElectricField</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rxlocs</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="s2">&quot;real&quot;</span>
        <span class="p">)</span>

        <span class="n">RxList</span> <span class="o">=</span> <span class="p">[</span><span class="n">rx_ex</span><span class="p">,</span> <span class="n">rx_ey</span><span class="p">]</span>

        <span class="n">sec_src</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">FDEM</span><span class="o">.</span><span class="n">Src</span><span class="o">.</span><span class="n">PrimSecMappedSigma</span><span class="p">(</span>
                <span class="n">RxList</span><span class="p">,</span>
                <span class="n">freq</span><span class="p">,</span>
                <span class="n">primaryProblem</span><span class="p">,</span>
                <span class="n">primarySurvey</span><span class="p">,</span>
                <span class="n">map2meshSecondary</span><span class="o">=</span><span class="n">map2meshSecondary</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span>
        <span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;... done secondary survey&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">FDEM</span><span class="o">.</span><span class="n">Survey</span><span class="p">(</span><span class="n">sec_src</span><span class="p">)</span>

    <span class="c1"># -------------- SOLVE ---------------------------- #</span>
    <span class="k">def</span> <span class="nf">solveSecondary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sec_problem</span><span class="p">,</span> <span class="n">sec_survey</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">plotIt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">sec_problem</span><span class="o">.</span><span class="n">survey</span> <span class="o">=</span> <span class="n">sec_survey</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Solving Secondary&quot;</span><span class="p">)</span>
        <span class="n">t0</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/time.html#time.time" title="time.time" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><span class="n">time</span><span class="o">.</span><span class="n">time</span></a><span class="p">()</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">sec_problem</span><span class="o">.</span><span class="n">fields</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">dpred</span> <span class="o">=</span> <span class="n">sec_problem</span><span class="o">.</span><span class="n">dpred</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">fields</span><span class="p">)</span>
        <span class="n">t1</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/time.html#time.time" title="time.time" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><span class="n">time</span><span class="o">.</span><span class="n">time</span></a><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ...done.   secondary time &quot;</span><span class="p">),</span> <span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span>

        <span class="k">return</span> <span class="n">fields</span><span class="p">,</span> <span class="n">dpred</span>

    <span class="c1"># ----------------------------------------------------------------- #</span>
    <span class="c1"># ------------ PLOTTING ------------------------------------------- #</span>
    <span class="c1"># ----------------------------------------------------------------- #</span>

    <span class="k">def</span> <span class="nf">plotPrimaryFields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">primaryFields</span><span class="p">,</span> <span class="n">saveFig</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># Interpolate onto a cartesian mesh with uniform cell sizes (better for</span>
        <span class="c1"># streamplots)</span>
        <span class="n">cs</span> <span class="o">=</span> <span class="mf">5.0</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="mf">1000.0</span>
        <span class="n">zmax</span> <span class="o">=</span> <span class="mf">1200.0</span>
        <span class="n">csx</span><span class="p">,</span> <span class="n">ncx</span> <span class="o">=</span> <span class="n">cs</span><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">ceil</span></a><span class="p">(</span><span class="n">xmax</span> <span class="o">/</span> <span class="n">cs</span><span class="p">)</span>
        <span class="n">csz</span><span class="p">,</span> <span class="n">ncz</span> <span class="o">=</span> <span class="n">cs</span><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">ceil</span></a><span class="p">(</span><span class="n">zmax</span> <span class="o">/</span> <span class="n">cs</span><span class="p">)</span>

        <span class="c1"># define the tensor mesh</span>
        <span class="n">meshcart</span> <span class="o">=</span> <a href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TensorMesh.html#discretize.TensorMesh" title="discretize.TensorMesh" class="sphx-glr-backref-module-discretize sphx-glr-backref-type-py-class"><span class="n">discretize</span><span class="o">.</span><span class="n">TensorMesh</span></a><span class="p">(</span>
            <span class="p">[[(</span><span class="n">csx</span><span class="p">,</span> <span class="n">ncx</span><span class="p">)],</span> <span class="p">[(</span><span class="n">csx</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span> <span class="p">[(</span><span class="n">csz</span><span class="p">,</span> <span class="n">ncz</span><span class="p">)]],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">csx</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="n">zmax</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="n">projF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshp</span><span class="o">.</span><span class="n">get_interpolation_matrix_cartesian_mesh</span><span class="p">(</span><span class="n">meshcart</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">)</span>

        <span class="n">jcart</span> <span class="o">=</span> <span class="n">projF</span> <span class="o">*</span> <span class="n">primaryFields</span><span class="p">[:,</span> <span class="s2">&quot;j&quot;</span><span class="p">]</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mf">7.75</span><span class="p">))</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">meshcart</span><span class="o">.</span><span class="n">plot_slice</span><span class="p">(</span>
            <span class="n">jcart</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
            <span class="n">normal</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span>
            <span class="n">v_type</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">,</span>
            <span class="n">view</span><span class="o">=</span><span class="s2">&quot;vec&quot;</span><span class="p">,</span>
            <span class="n">pcolor_opts</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;norm&quot;</span><span class="p">:</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.colors.LogNorm.html#matplotlib.colors.LogNorm" title="matplotlib.colors.LogNorm" class="sphx-glr-backref-module-matplotlib-colors sphx-glr-backref-type-py-class"><span class="n">LogNorm</span></a><span class="p">(),</span> <span class="s2">&quot;cmap&quot;</span><span class="p">:</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.get_cmap.html#matplotlib.pyplot.get_cmap" title="matplotlib.pyplot.get_cmap" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span></a><span class="p">(</span><span class="s2">&quot;viridis&quot;</span><span class="p">)},</span>
            <span class="n">stream_opts</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="s2">&quot;arrowsize&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="p">)</span>
        <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.colorbar.html#matplotlib.pyplot.colorbar" title="matplotlib.pyplot.colorbar" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span></a><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;real current density (A/m$^2$)&quot;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_adjustable</span><span class="p">(</span><span class="s2">&quot;box&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">1200.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">750.0</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Primary Current Density&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;radius (m)&quot;</span><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fontsize</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fontsize</span></a><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;z (m)&quot;</span><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fontsize</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fontsize</span></a><span class="p">)</span>

        <span class="k">if</span> <span class="n">saveFig</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;primaryCurrents&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">plotSecondarySource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">primaryFields</span><span class="p">,</span> <span class="n">saveFig</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># get source term</span>
        <span class="n">secondaryProblem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setupSecondaryProblem</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="p">)</span>
        <span class="n">secondaryProblem</span><span class="o">.</span><span class="n">solver</span> <span class="o">=</span> <span class="n">Solver</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">primaryProblem</span><span class="o">.</span><span class="n">solver</span> <span class="o">=</span> <span class="n">Solver</span>
        <span class="n">secondaryProblem</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtrue</span>
        <span class="n">secondarySurvey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setupSecondarySurvey</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">primaryProblem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">primarySurvey</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaryMap2meshs</span>
        <span class="p">)</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">secondarySurvey</span><span class="o">.</span><span class="n">source_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">s_e</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">s_e</span><span class="p">(</span><span class="n">secondaryProblem</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">primaryFields</span><span class="p">)</span>

        <span class="c1"># Mesh to interpolate onto for stream plots</span>
        <span class="n">cs</span> <span class="o">=</span> <span class="mf">5.0</span>
        <span class="n">csz</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="o">-</span><span class="mf">600.0</span><span class="p">,</span> <span class="mf">600.0</span>
        <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="o">-</span><span class="mf">600.0</span><span class="p">,</span> <span class="mf">600.0</span>
        <span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span> <span class="o">=</span> <span class="o">-</span><span class="mf">950.0</span> <span class="o">-</span> <span class="n">csz</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">950.0</span> <span class="o">+</span> <span class="n">csz</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="n">ncx</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">ceil</span></a><span class="p">((</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">cs</span><span class="p">)</span>
        <span class="n">ncy</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">ceil</span></a><span class="p">((</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">/</span> <span class="n">cs</span><span class="p">)</span>
        <span class="n">ncz</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">ceil</span></a><span class="p">((</span><span class="n">zmax</span> <span class="o">-</span> <span class="n">zmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">cs</span><span class="p">)</span>

        <span class="n">meshs_plt</span> <span class="o">=</span> <a href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TensorMesh.html#discretize.TensorMesh" title="discretize.TensorMesh" class="sphx-glr-backref-module-discretize sphx-glr-backref-type-py-class"><span class="n">discretize</span><span class="o">.</span><span class="n">TensorMesh</span></a><span class="p">(</span>
            <span class="p">[[(</span><span class="n">cs</span><span class="p">,</span> <span class="n">ncx</span><span class="p">)],</span> <span class="p">[(</span><span class="n">cs</span><span class="p">,</span> <span class="n">ncy</span><span class="p">)],</span> <span class="p">[(</span><span class="n">cs</span><span class="p">,</span> <span class="n">ncz</span><span class="p">)]],</span>
            <span class="p">[</span>
                <span class="n">xmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">xmin</span> <span class="o">+</span> <span class="n">xmax</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
                <span class="n">ymin</span> <span class="o">+</span> <span class="p">(</span><span class="n">ymin</span> <span class="o">+</span> <span class="n">ymax</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
                <span class="n">zmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">zmin</span> <span class="o">+</span> <span class="n">zmax</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">)</span>

        <span class="c1"># Construct interpolation matrices</span>
        <span class="n">Px</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshs</span><span class="o">.</span><span class="n">get_interpolation_matrix</span><span class="p">(</span><span class="n">meshs_plt</span><span class="o">.</span><span class="n">gridEx</span><span class="p">,</span> <span class="n">location_type</span><span class="o">=</span><span class="s2">&quot;Ex&quot;</span><span class="p">)</span>
        <span class="n">Py</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshs</span><span class="o">.</span><span class="n">get_interpolation_matrix</span><span class="p">(</span><span class="n">meshs_plt</span><span class="o">.</span><span class="n">gridEy</span><span class="p">,</span> <span class="n">location_type</span><span class="o">=</span><span class="s2">&quot;Ey&quot;</span><span class="p">)</span>
        <span class="n">Pz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshs</span><span class="o">.</span><span class="n">get_interpolation_matrix</span><span class="p">(</span><span class="n">meshs_plt</span><span class="o">.</span><span class="n">gridEz</span><span class="p">,</span> <span class="n">location_type</span><span class="o">=</span><span class="s2">&quot;Ez&quot;</span><span class="p">)</span>
        <span class="n">P</span> <span class="o">=</span> <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.vstack.html#scipy.sparse.vstack" title="scipy.sparse.vstack" class="sphx-glr-backref-module-scipy-sparse sphx-glr-backref-type-py-function"><span class="n">sp</span><span class="o">.</span><span class="n">vstack</span></a><span class="p">([</span><span class="n">Px</span><span class="p">,</span> <span class="n">Py</span><span class="p">,</span> <span class="n">Pz</span><span class="p">])</span>

        <span class="c1"># for regions outside of the anomalous block, the source current</span>
        <span class="c1"># density is identically zero. For plotting, we do not want to</span>
        <span class="c1"># interpolate into this region, so we build up masked arrays.</span>
        <span class="n">maskme_ex</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshs</span><span class="o">.</span><span class="n">gridEx</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshs</span><span class="o">.</span><span class="n">gridEx</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshs</span><span class="o">.</span><span class="n">gridEx</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshs</span><span class="o">.</span><span class="n">gridEx</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_y</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="p">)</span>

        <span class="n">maskme_ey</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshs</span><span class="o">.</span><span class="n">gridEy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshs</span><span class="o">.</span><span class="n">gridEy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshs</span><span class="o">.</span><span class="n">gridEy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshs</span><span class="o">.</span><span class="n">gridEy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_y</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="p">)</span>

        <span class="n">maskme_ez</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshs</span><span class="o">.</span><span class="n">gridEz</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshs</span><span class="o">.</span><span class="n">gridEz</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshs</span><span class="o">.</span><span class="n">gridEz</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshs</span><span class="o">.</span><span class="n">gridEz</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_y</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="p">)</span>

        <span class="n">maskme_e</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.hstack.html#numpy.hstack" title="numpy.hstack" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">hstack</span></a><span class="p">([</span><span class="n">maskme_ex</span><span class="p">,</span> <span class="n">maskme_ey</span><span class="p">,</span> <span class="n">maskme_ez</span><span class="p">])</span>

        <span class="c1"># interpolate down a layer</span>
        <span class="n">s_e_interp</span> <span class="o">=</span> <span class="n">s_e</span><span class="o">.</span><span class="n">real</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">s_e_interp</span><span class="p">[</span><span class="n">maskme_e</span><span class="p">]</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">nan</span></a>
        <span class="n">s_e_plt</span> <span class="o">=</span> <span class="n">P</span> <span class="o">*</span> <span class="n">s_e_interp</span>

        <span class="c1"># keep masked array for stream plots</span>
        <span class="n">s_e_stream_cc</span> <span class="o">=</span> <span class="n">meshs_plt</span><span class="o">.</span><span class="n">aveE2CCV</span> <span class="o">*</span> <span class="n">s_e_plt</span>

        <span class="c1"># re-assign zero for amplitude of the real current density</span>
        <span class="n">s_e_abs_cc</span> <span class="o">=</span> <span class="n">s_e_stream_cc</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">meshs_plt</span><span class="o">.</span><span class="n">nC</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="n">s_e_abs_cc</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span></a><span class="p">((</span><span class="n">s_e_abs_cc</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">s_e_abs_cc</span><span class="p">[</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">isnan</span></a><span class="p">(</span><span class="n">s_e_abs_cc</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">s_e_stream_cc</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ma.masked_where.html#numpy.ma.masked_where" title="numpy.ma.masked_where" class="sphx-glr-backref-module-numpy-ma sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span></a><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">isnan</span></a><span class="p">(</span><span class="n">s_e_stream_cc</span><span class="p">),</span> <span class="n">s_e_stream_cc</span><span class="p">)</span>

        <span class="c1"># plot</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">7.5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

        <span class="c1"># f = meshs_plt.plot_slice(</span>
        <span class="c1">#     np.ma.masked_where(maskme_e, s_e_plt.real),</span>
        <span class="c1">#     normal=&#39;Z&#39;,</span>
        <span class="c1">#     v_type=&#39;CCv&#39;,</span>
        <span class="c1">#     view=&#39;abs&#39;,</span>
        <span class="c1">#     pcolor_opts={&#39;cmap&#39;:plt.get_cmap(&#39;viridis&#39;)}, ax=ax</span>
        <span class="c1"># )</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span>
            <span class="n">meshs_plt</span><span class="o">.</span><span class="n">cell_centers_x</span><span class="p">,</span>
            <span class="n">meshs_plt</span><span class="o">.</span><span class="n">cell_centers_y</span><span class="p">,</span>
            <span class="p">(</span><span class="n">s_e_abs_cc</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">meshs_plt</span><span class="o">.</span><span class="n">vnC</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.get_cmap.html#matplotlib.pyplot.get_cmap" title="matplotlib.pyplot.get_cmap" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span></a><span class="p">(</span><span class="s2">&quot;viridis&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">streamplot</span><span class="p">(</span>
            <span class="n">meshs_plt</span><span class="o">.</span><span class="n">cell_centers_x</span><span class="p">,</span>
            <span class="n">meshs_plt</span><span class="o">.</span><span class="n">cell_centers_y</span><span class="p">,</span>
            <span class="n">s_e_stream_cc</span><span class="p">[:</span> <span class="n">meshs_plt</span><span class="o">.</span><span class="n">nC</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">meshs_plt</span><span class="o">.</span><span class="n">vnC</span><span class="p">[:</span><span class="mi">2</span><span class="p">]),</span>
            <span class="n">s_e_stream_cc</span><span class="p">[</span><span class="n">meshs_plt</span><span class="o">.</span><span class="n">nC</span> <span class="p">:</span> <span class="n">meshs_plt</span><span class="o">.</span><span class="n">nC</span> <span class="o">*</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">meshs_plt</span><span class="o">.</span><span class="n">vnC</span><span class="p">[:</span><span class="mi">2</span><span class="p">]),</span>
            <span class="n">density</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="n">arrowsize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x (m)&quot;</span><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fontsize</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fontsize</span></a><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;y (m)&quot;</span><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fontsize</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fontsize</span></a><span class="p">)</span>

        <span class="n">cb</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.colorbar.html#matplotlib.pyplot.colorbar" title="matplotlib.pyplot.colorbar" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span></a><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;real current density (A/m$^2$)&quot;</span><span class="p">)</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">set_powerlimits</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">update_ticks</span><span class="p">()</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_adjustable</span><span class="p">(</span><span class="s2">&quot;box&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="o">-</span><span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;(a) -950m Depth Slice&quot;</span><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fontsize</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fontsize</span></a><span class="p">)</span>
        <span class="c1"># interact(plotMe, ind=[0, meshs_plt.vnC[2]-1])</span>

        <span class="k">if</span> <span class="n">saveFig</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;secondarySource&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">plotData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_block</span><span class="p">,</span> <span class="n">data_back</span><span class="p">,</span> <span class="n">saveFig</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">XLIM</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.r_.html#numpy.r_" title="numpy.r_" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">r_</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1500</span><span class="p">,</span> <span class="mi">1500</span><span class="p">]</span>
        <span class="n">YLIM</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.r_.html#numpy.r_" title="numpy.r_" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">r_</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1500</span><span class="p">,</span> <span class="mi">1500</span><span class="p">]</span>

        <span class="n">sec_survey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setupSecondarySurvey</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">primaryProblem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">primarySurvey</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaryMap2meshs</span>
        <span class="p">)</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">sec_survey</span><span class="o">.</span><span class="n">source_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">rx0</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">receiver_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">nx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span></a><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rx0</span><span class="o">.</span><span class="n">locations</span><span class="p">)))</span>
        <span class="n">ny</span> <span class="o">=</span> <span class="n">nx</span>

        <span class="k">def</span> <span class="nf">plotDataFun</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">,</span>
            <span class="n">plotme</span><span class="p">,</span>
            <span class="n">num</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
            <span class="n">plotBlock</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">xlim</span><span class="o">=</span><span class="n">XLIM</span><span class="p">,</span>
            <span class="n">ylim</span><span class="o">=</span><span class="n">YLIM</span><span class="p">,</span>
            <span class="n">clim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">clabel</span><span class="o">=</span><span class="s2">&quot;Electric Field (V/m)&quot;</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;x (m)&quot;</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;y (m)&quot;</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">clim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">clim</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">absolute</span></a><span class="p">(</span><span class="n">plotme</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.r_.html#numpy.r_" title="numpy.r_" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">r_</span></a><span class="p">[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">clim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">clim</span> <span class="o">=</span> <span class="n">clim</span>

            <span class="n">f</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rx_x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rx_y</span><span class="p">,</span>
                <span class="n">plotme</span><span class="p">,</span>
                <span class="n">num</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.get_cmap.html#matplotlib.pyplot.get_cmap" title="matplotlib.pyplot.get_cmap" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span></a><span class="p">(</span><span class="s2">&quot;viridis&quot;</span><span class="p">),</span>
                <span class="n">vmin</span><span class="o">=</span><span class="n">clim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">vmax</span><span class="o">=</span><span class="n">clim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_adjustable</span><span class="p">(</span><span class="s2">&quot;box&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
            <span class="n">cb</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.colorbar.html#matplotlib.pyplot.colorbar" title="matplotlib.pyplot.colorbar" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span></a><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">clabel</span><span class="p">)</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">set_powerlimits</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">update_ticks</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">plotBlock</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <a href="https://numpy.org/doc/stable/reference/generated/numpy.r_.html#numpy.r_" title="numpy.r_" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">r_</span></a><span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">block_x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">block_x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">block_x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">block_x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">block_x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="p">],</span>
                    <a href="https://numpy.org/doc/stable/reference/generated/numpy.r_.html#numpy.r_" title="numpy.r_" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">r_</span></a><span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">block_y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">block_y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">block_y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">block_y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">block_y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">ax</span>

        <span class="n">ncontours</span> <span class="o">=</span> <span class="mi">50</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">mkvc</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="n">plotx0</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_block</span><span class="p">[:</span> <span class="n">rx0</span><span class="o">.</span><span class="n">nD</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="n">ploty0</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_block</span><span class="p">[</span><span class="n">rx0</span><span class="o">.</span><span class="n">nD</span> <span class="p">:])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>

        <span class="n">plotx1</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_block</span><span class="p">[:</span> <span class="n">rx0</span><span class="o">.</span><span class="n">nD</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_back</span><span class="p">[:</span> <span class="n">rx0</span><span class="o">.</span><span class="n">nD</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="n">ploty1</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_block</span><span class="p">[</span><span class="n">rx0</span><span class="o">.</span><span class="n">nD</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">data_back</span><span class="p">[</span><span class="n">rx0</span><span class="o">.</span><span class="n">nD</span> <span class="p">:])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>

        <span class="c1"># Plotting</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotDataFun</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">plotx0</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">ncontours</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;(a) Total E$_x$&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotDataFun</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">plotx1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">ncontours</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;(c) Secondary E$_x$&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotDataFun</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ploty0</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">ncontours</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;(b) Total E$_y$&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotDataFun</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ploty1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">ncontours</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;(d) Secondary E$_y$&quot;</span><span class="p">)</span>
        <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.tight_layout.html#matplotlib.pyplot.tight_layout" title="matplotlib.pyplot.tight_layout" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span></a><span class="p">()</span>

        <span class="k">if</span> <span class="n">saveFig</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;casingDpred&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plotSensitivities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">saveFig</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">plotJ</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">,</span>
            <span class="n">Jv</span><span class="p">,</span>
            <span class="n">title</span><span class="p">,</span>
            <span class="n">plotGrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;x (m)&quot;</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;y (m)&quot;</span><span class="p">,</span>
            <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">clim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">climCenter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">plotBlock</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">num</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
            <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">cblabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
            <span class="n">vlim</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">absolute</span></a><span class="p">(</span><span class="n">Jv</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.r_.html#numpy.r_" title="numpy.r_" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">r_</span></a><span class="p">[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">norm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rx_x</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rx_y</span><span class="p">,</span>
                    <span class="n">Jv</span><span class="p">,</span>
                    <span class="n">levels</span><span class="o">=</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.linspace.html#numpy.linspace" title="numpy.linspace" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">linspace</span></a><span class="p">(</span><span class="n">vlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">num</span><span class="p">),</span>
                    <span class="n">cmap</span><span class="o">=</span><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.get_cmap.html#matplotlib.pyplot.get_cmap" title="matplotlib.pyplot.get_cmap" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span></a><span class="p">(</span><span class="s2">&quot;viridis&quot;</span><span class="p">),</span>
                    <span class="n">vmin</span><span class="o">=</span><span class="n">vlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">vmax</span><span class="o">=</span><span class="n">vlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">cb</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.colorbar.html#matplotlib.pyplot.colorbar" title="matplotlib.pyplot.colorbar" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span></a><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">cblabel</span><span class="p">)</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">set_powerlimits</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                <span class="n">ticks</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="s2">&quot;</span><span class="si">{0:1.1e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.linspace.html#numpy.linspace" title="numpy.linspace" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">linspace</span></a><span class="p">(</span><span class="mf">0.95</span> <span class="o">*</span> <span class="n">vlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.95</span> <span class="o">*</span> <span class="n">vlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">5</span><span class="p">)</span>
                <span class="p">]</span>
                <span class="n">ticks</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ticks</span><span class="p">]</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">update_ticks</span><span class="p">()</span>

            <span class="k">elif</span> <span class="n">norm</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;lognorm&quot;</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.colors.LogNorm.html#matplotlib.colors.LogNorm" title="matplotlib.colors.LogNorm" class="sphx-glr-backref-module-matplotlib-colors sphx-glr-backref-type-py-class"><span class="n">LogNorm</span></a>

                <span class="n">f</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span>
                    <span class="n">rx_x</span><span class="p">,</span>
                    <span class="n">rx_y</span><span class="p">,</span>
                    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">absolute</span></a><span class="p">(</span><span class="n">Jv</span><span class="p">),</span>
                    <span class="n">num</span><span class="p">,</span>
                    <span class="n">cmap</span><span class="o">=</span><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.get_cmap.html#matplotlib.pyplot.get_cmap" title="matplotlib.pyplot.get_cmap" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span></a><span class="p">(</span><span class="s2">&quot;viridis&quot;</span><span class="p">),</span>
                    <span class="n">norm</span><span class="o">=</span><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.colors.LogNorm.html#matplotlib.colors.LogNorm" title="matplotlib.colors.LogNorm" class="sphx-glr-backref-module-matplotlib-colors sphx-glr-backref-type-py-class"><span class="n">LogNorm</span></a><span class="p">(),</span>
                <span class="p">)</span>
                <span class="n">cb</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.colorbar.html#matplotlib.pyplot.colorbar" title="matplotlib.pyplot.colorbar" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span></a><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">plotGrid</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meshs</span><span class="o">.</span><span class="n">plot_slice</span><span class="p">(</span>
                    <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">nan</span></a> <span class="o">*</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ones.html#numpy.ones" title="numpy.ones" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">ones</span></a><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">nC</span><span class="p">),</span> <span class="n">normal</span><span class="o">=</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">plotBlock</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <a href="https://numpy.org/doc/stable/reference/generated/numpy.r_.html#numpy.r_" title="numpy.r_" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">r_</span></a><span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">block_x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">block_x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">block_x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">block_x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">block_x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="p">],</span>
                    <a href="https://numpy.org/doc/stable/reference/generated/numpy.r_.html#numpy.r_" title="numpy.r_" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">r_</span></a><span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">block_y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">block_y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">block_y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">block_y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">block_y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="n">ax</span>

        <span class="c1"># Plot Conductivity contribution</span>
        <span class="n">plotGrid</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">plotBlock</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ncontours</span> <span class="o">=</span> <span class="mi">30</span>

        <span class="n">xlim</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.r_.html#numpy.r_" title="numpy.r_" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">r_</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1500</span><span class="p">,</span> <span class="mi">1500</span><span class="p">]</span>
        <span class="n">ylim</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.r_.html#numpy.r_" title="numpy.r_" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">r_</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1500</span><span class="p">,</span> <span class="mi">1500</span><span class="p">]</span>

        <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rx_x</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">nrx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rxlocs</span><span class="p">)</span>

        <span class="n">J_back_ex</span> <span class="o">=</span> <span class="n">J</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="n">nrx</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="n">J_back_ey</span> <span class="o">=</span> <span class="n">J</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">nrx</span><span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="n">J_layer_ex</span> <span class="o">=</span> <span class="n">J</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="n">nrx</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="n">J_layer_ey</span> <span class="o">=</span> <span class="n">J</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">nrx</span><span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="n">J_block_ex</span> <span class="o">=</span> <span class="n">J</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="n">nrx</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="n">J_block_ey</span> <span class="o">=</span> <span class="n">J</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">nrx</span><span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>

        <span class="n">clabelSigs</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;Sensitivity (V/m / log($\sigma$))&quot;</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotJ</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">J_back_ex</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;(a) Sensitivity of $E_x$ wrt log($\sigma_</span><span class="si">{back}</span><span class="s2">$)&quot;</span><span class="p">,</span>
            <span class="n">plotGrid</span><span class="o">=</span><span class="n">plotGrid</span><span class="p">,</span>
            <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span>
            <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span>
            <span class="n">plotBlock</span><span class="o">=</span><span class="n">plotBlock</span><span class="p">,</span>
            <span class="n">num</span><span class="o">=</span><span class="n">ncontours</span><span class="p">,</span>
            <span class="n">cblabel</span><span class="o">=</span><span class="n">clabelSigs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotJ</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">J_back_ey</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;(b) Sensitivity of $E_y$ wrt log($\sigma_</span><span class="si">{back}</span><span class="s2">$)&quot;</span><span class="p">,</span>
            <span class="n">plotGrid</span><span class="o">=</span><span class="n">plotGrid</span><span class="p">,</span>
            <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span>
            <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span>
            <span class="n">plotBlock</span><span class="o">=</span><span class="n">plotBlock</span><span class="p">,</span>
            <span class="n">num</span><span class="o">=</span><span class="n">ncontours</span><span class="p">,</span>
            <span class="n">cblabel</span><span class="o">=</span><span class="n">clabelSigs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotJ</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">J_layer_ex</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;(c) Sensitivity of $E_x$ wrt log($\sigma_</span><span class="si">{layer}</span><span class="s2">$)&quot;</span><span class="p">,</span>
            <span class="n">plotGrid</span><span class="o">=</span><span class="n">plotGrid</span><span class="p">,</span>
            <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span>
            <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span>
            <span class="n">plotBlock</span><span class="o">=</span><span class="n">plotBlock</span><span class="p">,</span>
            <span class="n">num</span><span class="o">=</span><span class="n">ncontours</span><span class="p">,</span>
            <span class="n">cblabel</span><span class="o">=</span><span class="n">clabelSigs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotJ</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">J_layer_ey</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;(d) Sensitivity of $E_y$ wrt log($\sigma_</span><span class="si">{layer}</span><span class="s2">$)&quot;</span><span class="p">,</span>
            <span class="n">plotGrid</span><span class="o">=</span><span class="n">plotGrid</span><span class="p">,</span>
            <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span>
            <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span>
            <span class="n">plotBlock</span><span class="o">=</span><span class="n">plotBlock</span><span class="p">,</span>
            <span class="n">num</span><span class="o">=</span><span class="n">ncontours</span><span class="p">,</span>
            <span class="n">cblabel</span><span class="o">=</span><span class="n">clabelSigs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">climsigblock</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.r_.html#numpy.r_" title="numpy.r_" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">r_</span></a><span class="p">[</span><span class="o">-</span><span class="mf">6e-8</span><span class="p">,</span> <span class="mf">6e-8</span><span class="p">]</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotJ</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">J_block_ex</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;(e) Sensitivity of $E_x$ wrt log($\sigma_</span><span class="si">{block}</span><span class="s2">$)&quot;</span><span class="p">,</span>
            <span class="n">plotGrid</span><span class="o">=</span><span class="n">plotGrid</span><span class="p">,</span>
            <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span>
            <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span>
            <span class="n">clim</span><span class="o">=</span><span class="n">climsigblock</span><span class="p">,</span>
            <span class="n">plotBlock</span><span class="o">=</span><span class="n">plotBlock</span><span class="p">,</span>
            <span class="n">num</span><span class="o">=</span><span class="n">ncontours</span><span class="p">,</span>
            <span class="n">cblabel</span><span class="o">=</span><span class="n">clabelSigs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotJ</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">J_block_ey</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;(f) Sensitivity of $E_y$ wrt log($\sigma_</span><span class="si">{block}</span><span class="s2">$)&quot;</span><span class="p">,</span>
            <span class="n">plotGrid</span><span class="o">=</span><span class="n">plotGrid</span><span class="p">,</span>
            <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span>
            <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span>
            <span class="n">clim</span><span class="o">=</span><span class="n">climsigblock</span><span class="p">,</span>
            <span class="n">plotBlock</span><span class="o">=</span><span class="n">plotBlock</span><span class="p">,</span>
            <span class="n">num</span><span class="o">=</span><span class="n">ncontours</span><span class="p">,</span>
            <span class="n">cblabel</span><span class="o">=</span><span class="n">clabelSigs</span><span class="p">,</span>
        <span class="p">)</span>

        <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.tight_layout.html#matplotlib.pyplot.tight_layout" title="matplotlib.pyplot.tight_layout" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span></a><span class="p">()</span>

        <span class="k">if</span> <span class="n">saveFig</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;J_sigmas&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

        <span class="c1"># Plot layer contribution</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="c1"># ax = utils.mkvc(ax)</span>

        <span class="n">xlim</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.r_.html#numpy.r_" title="numpy.r_" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">r_</span></a><span class="p">[</span><span class="o">-</span><span class="mf">1500.0</span><span class="p">,</span> <span class="mf">1500.0</span><span class="p">]</span>
        <span class="n">ylim</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.r_.html#numpy.r_" title="numpy.r_" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">r_</span></a><span class="p">[</span><span class="o">-</span><span class="mf">1500.0</span><span class="p">,</span> <span class="mf">1500.0</span><span class="p">]</span>

        <span class="n">J_z0_ex</span><span class="p">,</span> <span class="n">J_z0_ey</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">J</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="n">nrx</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">),</span>
            <span class="n">J</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="n">nrx</span><span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">J_hz_ex</span><span class="p">,</span> <span class="n">J_hz_ey</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">J</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="p">:</span><span class="n">nrx</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">),</span>
            <span class="n">J</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="n">nrx</span><span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotJ</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">J_z0_ex</span><span class="p">,</span>
            <span class="s2">&quot;(g) Sensitivity of $E_x$ wrt layer $z_0$&quot;</span><span class="p">,</span>
            <span class="n">plotGrid</span><span class="o">=</span><span class="n">plotGrid</span><span class="p">,</span>
            <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span>
            <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span>
            <span class="n">plotBlock</span><span class="o">=</span><span class="n">plotBlock</span><span class="p">,</span>
            <span class="n">num</span><span class="o">=</span><span class="n">ncontours</span><span class="p">,</span>
            <span class="n">cblabel</span><span class="o">=</span><span class="s2">&quot;Sensitivity (V/m / m)&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotJ</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">J_z0_ey</span><span class="p">,</span>
            <span class="s2">&quot;(h) Sensitivity of $E_y$ wrt layer $z_0$&quot;</span><span class="p">,</span>
            <span class="n">plotGrid</span><span class="o">=</span><span class="n">plotGrid</span><span class="p">,</span>
            <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span>
            <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span>
            <span class="n">plotBlock</span><span class="o">=</span><span class="n">plotBlock</span><span class="p">,</span>
            <span class="n">num</span><span class="o">=</span><span class="n">ncontours</span><span class="p">,</span>
            <span class="n">cblabel</span><span class="o">=</span><span class="s2">&quot;Sensitivity (V/m / m)&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotJ</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">J_hz_ex</span><span class="p">,</span>
            <span class="s2">&quot;(i) Sensitivity of $E_x$ wrt layer $h$&quot;</span><span class="p">,</span>
            <span class="n">plotGrid</span><span class="o">=</span><span class="n">plotGrid</span><span class="p">,</span>
            <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span>
            <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span>
            <span class="n">plotBlock</span><span class="o">=</span><span class="n">plotBlock</span><span class="p">,</span>
            <span class="n">num</span><span class="o">=</span><span class="n">ncontours</span><span class="p">,</span>
            <span class="n">cblabel</span><span class="o">=</span><span class="s2">&quot;Sensitivity (V/m / m)&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotJ</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">J_hz_ey</span><span class="p">,</span>
            <span class="s2">&quot;(j) Sensitivity of $E_y$ wrt layer $h$&quot;</span><span class="p">,</span>
            <span class="n">plotGrid</span><span class="o">=</span><span class="n">plotGrid</span><span class="p">,</span>
            <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span>
            <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span>
            <span class="n">plotBlock</span><span class="o">=</span><span class="n">plotBlock</span><span class="p">,</span>
            <span class="n">num</span><span class="o">=</span><span class="n">ncontours</span><span class="p">,</span>
            <span class="n">cblabel</span><span class="o">=</span><span class="s2">&quot;Sensitivity (V/m / m)&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.tight_layout.html#matplotlib.pyplot.tight_layout" title="matplotlib.pyplot.tight_layout" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span></a><span class="p">()</span>

        <span class="k">if</span> <span class="n">saveFig</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;J_layer&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

        <span class="c1"># Block Geometry</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>

        <span class="n">xlim</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.r_.html#numpy.r_" title="numpy.r_" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">r_</span></a><span class="p">[</span><span class="o">-</span><span class="mf">1500.0</span><span class="p">,</span> <span class="mf">1500.0</span><span class="p">]</span>
        <span class="n">ylim</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.r_.html#numpy.r_" title="numpy.r_" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">r_</span></a><span class="p">[</span><span class="o">-</span><span class="mf">1500.0</span><span class="p">,</span> <span class="mf">1500.0</span><span class="p">]</span>

        <span class="n">J_x0_ex</span> <span class="o">=</span> <span class="n">J</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="p">:</span><span class="n">nrx</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="n">J_x0_ey</span> <span class="o">=</span> <span class="n">J</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="n">nrx</span><span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="n">J_y0_ex</span> <span class="o">=</span> <span class="n">J</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="p">:</span><span class="n">nrx</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="n">J_y0_ey</span> <span class="o">=</span> <span class="n">J</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="n">nrx</span><span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="n">J_dx_ex</span> <span class="o">=</span> <span class="n">J</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="p">:</span><span class="n">nrx</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="n">J_dx_ey</span> <span class="o">=</span> <span class="n">J</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="n">nrx</span><span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="n">J_dy_ex</span> <span class="o">=</span> <span class="n">J</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="p">:</span><span class="n">nrx</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="n">J_dy_ey</span> <span class="o">=</span> <span class="n">J</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="n">nrx</span><span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotJ</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">J_x0_ex</span><span class="p">,</span>
            <span class="s2">&quot;(k) Sensitivity of $E_x$ wrt block $x_0$&quot;</span><span class="p">,</span>
            <span class="n">plotGrid</span><span class="o">=</span><span class="n">plotGrid</span><span class="p">,</span>
            <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span>
            <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span>
            <span class="n">plotBlock</span><span class="o">=</span><span class="n">plotBlock</span><span class="p">,</span>
            <span class="n">num</span><span class="o">=</span><span class="n">ncontours</span><span class="p">,</span>
            <span class="n">cblabel</span><span class="o">=</span><span class="s2">&quot;Sensitivity (V/m / m)&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotJ</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">J_x0_ey</span><span class="p">,</span>
            <span class="s2">&quot;(l) Sensitivity of $E_y$ wrt block $x_0$&quot;</span><span class="p">,</span>
            <span class="n">plotGrid</span><span class="o">=</span><span class="n">plotGrid</span><span class="p">,</span>
            <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span>
            <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span>
            <span class="n">plotBlock</span><span class="o">=</span><span class="n">plotBlock</span><span class="p">,</span>
            <span class="n">num</span><span class="o">=</span><span class="n">ncontours</span><span class="p">,</span>
            <span class="n">cblabel</span><span class="o">=</span><span class="s2">&quot;Sensitivity (V/m / m)&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotJ</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">J_y0_ex</span><span class="p">,</span>
            <span class="s2">&quot;(m) Sensitivity of $E_x$ wrt block $y_0$&quot;</span><span class="p">,</span>
            <span class="n">plotGrid</span><span class="o">=</span><span class="n">plotGrid</span><span class="p">,</span>
            <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span>
            <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span>
            <span class="n">plotBlock</span><span class="o">=</span><span class="n">plotBlock</span><span class="p">,</span>
            <span class="n">num</span><span class="o">=</span><span class="n">ncontours</span><span class="p">,</span>
            <span class="n">cblabel</span><span class="o">=</span><span class="s2">&quot;Sensitivity (V/m / m)&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotJ</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">J_y0_ey</span><span class="p">,</span>
            <span class="s2">&quot;(n) Sensitivity of $E_y$ wrt block $y_0$&quot;</span><span class="p">,</span>
            <span class="n">plotGrid</span><span class="o">=</span><span class="n">plotGrid</span><span class="p">,</span>
            <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span>
            <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span>
            <span class="n">plotBlock</span><span class="o">=</span><span class="n">plotBlock</span><span class="p">,</span>
            <span class="n">num</span><span class="o">=</span><span class="n">ncontours</span><span class="p">,</span>
            <span class="n">cblabel</span><span class="o">=</span><span class="s2">&quot;Sensitivity (V/m / m)&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotJ</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">J_dx_ex</span><span class="p">,</span>
            <span class="s2">&quot;(o) Sensitivity of $E_x$ wrt block $d_x$&quot;</span><span class="p">,</span>
            <span class="n">plotGrid</span><span class="o">=</span><span class="n">plotGrid</span><span class="p">,</span>
            <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span>
            <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span>
            <span class="n">plotBlock</span><span class="o">=</span><span class="n">plotBlock</span><span class="p">,</span>
            <span class="n">num</span><span class="o">=</span><span class="n">ncontours</span><span class="p">,</span>
            <span class="n">cblabel</span><span class="o">=</span><span class="s2">&quot;Sensitivity (V/m / m)&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotJ</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">J_dx_ey</span><span class="p">,</span>
            <span class="s2">&quot;(p) Sensitivity of $E_y$ wrt block $d_x$&quot;</span><span class="p">,</span>
            <span class="n">plotGrid</span><span class="o">=</span><span class="n">plotGrid</span><span class="p">,</span>
            <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span>
            <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span>
            <span class="n">plotBlock</span><span class="o">=</span><span class="n">plotBlock</span><span class="p">,</span>
            <span class="n">num</span><span class="o">=</span><span class="n">ncontours</span><span class="p">,</span>
            <span class="n">cblabel</span><span class="o">=</span><span class="s2">&quot;Sensitivity (V/m / m)&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotJ</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">J_dy_ex</span><span class="p">,</span>
            <span class="s2">&quot;(q) Sensitivity of $E_x$ wrt block $d_y$&quot;</span><span class="p">,</span>
            <span class="n">plotGrid</span><span class="o">=</span><span class="n">plotGrid</span><span class="p">,</span>
            <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span>
            <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span>
            <span class="n">plotBlock</span><span class="o">=</span><span class="n">plotBlock</span><span class="p">,</span>
            <span class="n">num</span><span class="o">=</span><span class="n">ncontours</span><span class="p">,</span>
            <span class="n">cblabel</span><span class="o">=</span><span class="s2">&quot;Sensitivity (V/m / m)&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotJ</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">J_dy_ey</span><span class="p">,</span>
            <span class="s2">&quot;(r) Sensitivity of $E_y$ wrt block $d_y$&quot;</span><span class="p">,</span>
            <span class="n">plotGrid</span><span class="o">=</span><span class="n">plotGrid</span><span class="p">,</span>
            <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span>
            <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span>
            <span class="n">plotBlock</span><span class="o">=</span><span class="n">plotBlock</span><span class="p">,</span>
            <span class="n">num</span><span class="o">=</span><span class="n">ncontours</span><span class="p">,</span>
            <span class="n">cblabel</span><span class="o">=</span><span class="s2">&quot;Sensitivity (V/m / m)&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.tight_layout.html#matplotlib.pyplot.tight_layout" title="matplotlib.pyplot.tight_layout" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span></a><span class="p">()</span>

        <span class="k">if</span> <span class="n">saveFig</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;J_block&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

    <span class="c1"># ---------------------------------------------------------------------- #</span>
    <span class="c1"># ---------------- Run the example ------------------------------------- #</span>
    <span class="c1"># ---------------------------------------------------------------------- #</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">plotIt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">runTests</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">saveFields</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">saveFig</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

        <span class="k">if</span> <span class="n">plotIt</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>  <span class="c1"># Plot the Primary Model</span>
            <span class="c1"># self.plotPrimaryMesh() # plot the mesh</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotPrimaryProperties</span><span class="p">()</span>  <span class="c1"># plot mu, sigma</span>

        <span class="c1"># Primary Simulation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">primaryProblem</span><span class="o">.</span><span class="n">survey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">primarySurvey</span>
        <span class="n">primfields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solvePrimary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primaryProblem</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mtrue</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">saveFields</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <a href="https://numpy.org/doc/stable/reference/generated/numpy.save.html#numpy.save" title="numpy.save" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">save</span></a><span class="p">(</span><span class="s2">&quot;primaryfields_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span> <span class="n">primfields</span><span class="p">[:,</span> <span class="p">:])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   saved </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="s2">&quot;primaryfields_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">NAME</span><span class="p">)</span>

        <span class="n">mback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtrue</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">mback</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">log</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sigmalayer</span><span class="p">)</span>

        <span class="c1"># Secondary Problem and Survey</span>
        <span class="n">sec_problem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setupSecondaryProblem</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="p">)</span>

        <span class="n">sec_survey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setupSecondarySurvey</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">primaryProblem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">primarySurvey</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaryMap2meshs</span>
        <span class="p">)</span>
        <span class="n">sec_problem</span><span class="o">.</span><span class="n">survey</span> <span class="o">=</span> <span class="n">sec_survey</span>

        <span class="c1"># layered earth only (background)</span>
        <span class="n">background_problem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setupSecondaryProblem</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">primaryMap2meshs</span><span class="p">)</span>
        <span class="n">background_survey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setupSecondarySurvey</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">primaryProblem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">primarySurvey</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaryMap2meshs</span>
        <span class="p">)</span>
        <span class="n">background_problem</span><span class="o">.</span><span class="n">survey</span> <span class="o">=</span> <span class="n">background_survey</span>

        <span class="c1"># -------------- Test the sensitivity ----------------------------- #</span>
        <span class="k">if</span> <span class="n">runTests</span><span class="p">:</span>
            <span class="c1"># Test Block Model</span>
            <span class="k">def</span> <span class="nf">fun</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">sec_problem</span><span class="o">.</span><span class="n">dpred</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sec_problem</span><span class="o">.</span><span class="n">Jvec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mtrue</span><span class="p">,</span> <span class="n">x</span><span class="p">)]</span>

            <span class="n">tests</span><span class="o">.</span><span class="n">check_derivative</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtrue</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">plotIt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># -------------- Calculate Fields --------------------------------- #</span>
        <span class="c1"># Background</span>
        <span class="n">t0</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/time.html#time.time" title="time.time" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><span class="n">time</span><span class="o">.</span><span class="n">time</span></a><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;solving background ... &quot;</span><span class="p">)</span>
        <span class="n">fieldsback</span><span class="p">,</span> <span class="n">dpredback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solveSecondary</span><span class="p">(</span>
            <span class="n">background_problem</span><span class="p">,</span> <span class="n">background_survey</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtrue</span>
        <span class="p">)</span>
        <span class="n">t1</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/time.html#time.time" title="time.time" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><span class="n">time</span><span class="o">.</span><span class="n">time</span></a><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;... done.   dpred_back </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">saveFields</span><span class="p">:</span>
            <a href="https://numpy.org/doc/stable/reference/generated/numpy.save.html#numpy.save" title="numpy.save" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">save</span></a><span class="p">(</span><span class="s2">&quot;dpred_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">NAME</span> <span class="o">+</span> <span class="s2">&quot;_back&quot;</span><span class="p">,</span> <span class="n">dpredback</span><span class="p">)</span>
            <a href="https://numpy.org/doc/stable/reference/generated/numpy.save.html#numpy.save" title="numpy.save" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">save</span></a><span class="p">(</span><span class="s2">&quot;fields_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">NAME</span> <span class="o">+</span> <span class="s2">&quot;_back&quot;</span><span class="p">,</span> <span class="n">fieldsback</span><span class="p">[:,</span> <span class="p">:])</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   saved </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NAME</span> <span class="o">+</span> <span class="s2">&quot;_back&quot;</span><span class="p">))</span>

        <span class="c1"># with Block</span>
        <span class="n">t0</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/time.html#time.time" title="time.time" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><span class="n">time</span><span class="o">.</span><span class="n">time</span></a><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;solving with block ... &quot;</span><span class="p">)</span>
        <span class="n">fields</span><span class="p">,</span> <span class="n">dpred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solveSecondary</span><span class="p">(</span><span class="n">sec_problem</span><span class="p">,</span> <span class="n">sec_survey</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtrue</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;... done.   dpred </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">saveFields</span><span class="p">:</span>
            <a href="https://numpy.org/doc/stable/reference/generated/numpy.save.html#numpy.save" title="numpy.save" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">save</span></a><span class="p">(</span><span class="s2">&quot;dpred_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span> <span class="n">dpred</span><span class="p">)</span>
            <a href="https://numpy.org/doc/stable/reference/generated/numpy.save.html#numpy.save" title="numpy.save" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">save</span></a><span class="p">(</span><span class="s2">&quot;fields_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span> <span class="n">fields</span><span class="p">[:,</span> <span class="p">:])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   saved </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NAME</span><span class="p">))</span>

        <span class="n">t1</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/time.html#time.time" title="time.time" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><span class="n">time</span><span class="o">.</span><span class="n">time</span></a><span class="p">()</span>

        <span class="c1"># -------------- Calculate J --------------------------------- #</span>
        <span class="c1"># Calculate J with block</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;starting J with block&quot;</span><span class="p">)</span>
        <span class="n">t0</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/time.html#time.time" title="time.time" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><span class="n">time</span><span class="o">.</span><span class="n">time</span></a><span class="p">()</span>

        <span class="n">J</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mtrue</span><span class="p">)):</span>
            <span class="n">ei</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.zeros_like.html#numpy.zeros_like" title="numpy.zeros_like" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mtrue</span><span class="p">)</span>
            <span class="n">ei</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="n">J</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sec_problem</span><span class="o">.</span><span class="n">Jvec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mtrue</span><span class="p">,</span> <span class="n">ei</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">fields</span><span class="p">))</span>

        <span class="n">J</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.vstack.html#numpy.vstack" title="numpy.vstack" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">vstack</span></a><span class="p">(</span><span class="n">J</span><span class="p">)</span>

        <span class="n">t1</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/time.html#time.time" title="time.time" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><span class="n">time</span><span class="o">.</span><span class="n">time</span></a><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   J </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">saveFields</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <a href="https://numpy.org/doc/stable/reference/generated/numpy.save.html#numpy.save" title="numpy.save" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">save</span></a><span class="p">(</span><span class="s2">&quot;J_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span> <span class="n">J</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   saved </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;J_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">NAME</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;primfields&quot;</span><span class="p">:</span> <span class="n">primfields</span><span class="p">,</span>  <span class="c1"># primary fields</span>
            <span class="s2">&quot;fieldsback&quot;</span><span class="p">:</span> <span class="n">fieldsback</span><span class="p">,</span>  <span class="c1"># fields without block</span>
            <span class="s2">&quot;dpredback&quot;</span><span class="p">:</span> <span class="n">dpredback</span><span class="p">,</span>  <span class="c1"># predicted data without block</span>
            <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>  <span class="c1"># fields with block</span>
            <span class="s2">&quot;dpred&quot;</span><span class="p">:</span> <span class="n">dpred</span><span class="p">,</span>  <span class="c1"># predicted data with block</span>
            <span class="s2">&quot;J&quot;</span><span class="p">:</span> <span class="n">J</span><span class="p">,</span>  <span class="c1"># sensitivity</span>
        <span class="p">}</span>


<span class="k">class</span> <span class="nc">PrimSecCasingStoredResults</span><span class="p">(</span><span class="n">PrimSecCasingExample</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://storage.googleapis.com/simpeg/papers/Heagyetal2016/&quot;</span>

    <span class="c1"># cloudfiles = [</span>
    <span class="c1">#     &#39;primaryfields_PrimSec_5e6Casing_50Mu_05Hz_LargeCondBody.npy&#39;,</span>
    <span class="c1">#     &#39;dpred_PrimSec_5e6Casing_50Mu_05Hz_LargeCondBody_back.npy&#39;,</span>
    <span class="c1">#     &#39;dpred_PrimSec_5e6Casing_50Mu_05Hz_LargeCondBody.npy&#39;,</span>
    <span class="c1">#     &#39;J_PrimSec_5e6Casing_50Mu_05Hz_LargeCondBody.npy&#39;,</span>
    <span class="c1">#              ]</span>

    <span class="n">cloudfile</span> <span class="o">=</span> <span class="s2">&quot;Heagyetal2016Casing.hdf5&quot;</span>

    <span class="n">entry_names</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;primaryfields_h_PrimSec_5e6Casing_50Mu_05Hz_LargeCondBody&quot;</span><span class="p">,</span>
        <span class="s2">&quot;dpred_PrimSec_5e6Casing_50Mu_05Hz_LargeCondBody_back&quot;</span><span class="p">,</span>
        <span class="s2">&quot;dpred_PrimSec_5e6Casing_50Mu_05Hz_LargeCondBody&quot;</span><span class="p">,</span>
        <span class="s2">&quot;J_PrimSec_5e6Casing_50Mu_05Hz_LargeCondBody&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="nf">removeStoredResults</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">shutil</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Removing </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">))</span>
        <a href="https://docs.python.org/3/library/shutil.html#shutil.rmtree" title="shutil.rmtree" class="sphx-glr-backref-module-shutil sphx-glr-backref-type-py-function"><span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotIt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">runTests</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">saveFig</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">download</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudfile</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s2">&quot;~/Downloads/simpegtemp&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span></a><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span></a><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># resultsFiles = [&#39;{filepath}{slash}{file}&#39;.format(</span>
        <span class="c1">#     filepath=self.filepath, slash=os.path.sep, file=file)</span>
        <span class="c1">#     for file in self.cloudfiles]</span>
        <span class="c1"># results = [np.load(file, encoding=&#39;bytes&#39;) for file in resultsFiles]</span>

        <span class="n">h5f</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/collections.abc.html#collections.abc.MutableMapping" title="collections.abc.MutableMapping" class="sphx-glr-backref-module-collections-abc sphx-glr-backref-type-py-class"><span class="n">h5py</span><span class="o">.</span><span class="n">File</span></a><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">h5f</span><span class="p">[</span><span class="n">entry_name</span><span class="p">][:]</span> <span class="k">for</span> <span class="n">entry_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry_names</span><span class="p">]</span>
        <span class="n">results</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s2">&quot;primfields&quot;</span><span class="p">,</span> <span class="s2">&quot;dpredback&quot;</span><span class="p">,</span> <span class="s2">&quot;dpred&quot;</span><span class="p">,</span> <span class="s2">&quot;J&quot;</span><span class="p">],</span> <span class="n">results</span><span class="p">))</span>

        <span class="c1"># Put the primary fields into a fields object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">primaryProblem</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtrue</span>  <span class="c1"># set the current model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">primaryProblem</span><span class="o">.</span><span class="n">survey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">primarySurvey</span>
        <span class="n">primaryFields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaryProblem</span><span class="o">.</span><span class="n">fieldsPair</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primaryProblem</span><span class="p">)</span>
        <span class="n">primaryFields</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">primarySurvey</span><span class="o">.</span><span class="n">source_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;hSolution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span>
            <span class="s2">&quot;primfields&quot;</span>
        <span class="p">]</span>

        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;primfields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">primaryFields</span>

        <span class="k">return</span> <span class="n">results</span>


<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">plotIt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">runTests</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">reRun</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">saveFig</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    EM Heagyetal2016 CasingFwd3DPrimSecSrc</span>
<span class="sd">    ======================================</span>

<span class="sd">    Computation of Sensitivities for the primary-secondary example shown in</span>
<span class="sd">    Heagy et al 2016.</span>

<span class="sd">    :param bool plotIt: plot results</span>
<span class="sd">    :param bool runTests: run sensitivity tests? (slow...)</span>
<span class="sd">    :param bool reRun: recompute results? or just download stored results</span>
<span class="sd">        and plot</span>
<span class="sd">    :param bool saveFig: save the figures?</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># recompute results?</span>
    <span class="k">if</span> <span class="n">reRun</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">casingExample</span> <span class="o">=</span> <span class="n">PrimSecCasingExample</span><span class="p">()</span>

    <span class="c1"># or download stored results</span>
    <span class="k">elif</span> <span class="n">reRun</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">casingExample</span> <span class="o">=</span> <span class="n">PrimSecCasingStoredResults</span><span class="p">()</span>

    <span class="n">dataDict</span> <span class="o">=</span> <span class="n">casingExample</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">runTests</span><span class="o">=</span><span class="n">runTests</span><span class="p">)</span>

    <span class="c1"># plot some things</span>
    <span class="k">if</span> <span class="n">plotIt</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">saveFig</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">casingExample</span><span class="o">.</span><span class="n">plotPrimaryFields</span><span class="p">(</span><span class="n">dataDict</span><span class="p">[</span><span class="s2">&quot;primfields&quot;</span><span class="p">],</span> <span class="n">saveFig</span><span class="o">=</span><span class="n">saveFig</span><span class="p">)</span>
        <span class="n">casingExample</span><span class="o">.</span><span class="n">plotSecondarySource</span><span class="p">(</span><span class="n">dataDict</span><span class="p">[</span><span class="s2">&quot;primfields&quot;</span><span class="p">],</span> <span class="n">saveFig</span><span class="o">=</span><span class="n">saveFig</span><span class="p">)</span>
        <span class="n">casingExample</span><span class="o">.</span><span class="n">plotData</span><span class="p">(</span>
            <span class="n">dataDict</span><span class="p">[</span><span class="s2">&quot;dpred&quot;</span><span class="p">],</span> <span class="n">dataDict</span><span class="p">[</span><span class="s2">&quot;dpredback&quot;</span><span class="p">],</span> <span class="n">saveFig</span><span class="o">=</span><span class="n">saveFig</span>
        <span class="p">)</span>
        <span class="n">casingExample</span><span class="o">.</span><span class="n">plotSensitivities</span><span class="p">(</span><span class="n">dataDict</span><span class="p">[</span><span class="s2">&quot;J&quot;</span><span class="p">],</span> <span class="n">saveFig</span><span class="o">=</span><span class="n">saveFig</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plotIt</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.show.html#matplotlib.pyplot.show" title="matplotlib.pyplot.show" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>

    <span class="c1"># remove the downloaded results</span>
    <span class="k">if</span> <span class="n">reRun</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">casingExample</span><span class="o">.</span><span class="n">removeStoredResults</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
            <span class="k">pass</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">run</span><span class="p">(</span><span class="n">plotIt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">runTests</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">reRun</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">saveFig</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 27.600 seconds)</p>
<p><strong>Estimated memory usage:</strong>  1573 MB</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-content-examples-20-published-plot-heagyetal2017-casing-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../../_downloads/8ccf82c5067a8a36b26d6751f72889a2/plot_heagyetal2017_casing.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_heagyetal2017_casing.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../../_downloads/286d42821e623163212977607c6115fc/plot_heagyetal2017_casing.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_heagyetal2017_casing.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>


                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="plot_effective_medium_theory.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Effective Medium Theory Mapping</p>
      </div>
    </a>
    <a class="right-next"
       href="plot_heagyetal2017_cyl_inversions.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Heagy et al., 2017 1D FDEM and TDEM inversions</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="../../../_sources/content/examples/20-published/plot_heagyetal2017_casing.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>